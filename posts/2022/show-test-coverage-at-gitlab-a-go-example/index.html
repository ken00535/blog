<!DOCTYPE html><html domain="blog.kenwsc.com" ga-id="G-G76M9XJCKN" lang="zh-TW"><head><meta charset="utf-8"><meta content="width=device-width,initial-scale=1" name="viewport"><meta content="Backend,Golang" name="keywords"><link href="/img/favicon/favicon.png?hash=b6fc65e341" rel="icon" type="image/png"><meta content="#5789d3" name="theme-color"><title>在 GitLab 顯示測試覆蓋率：以 Go 為例</title><meta content="在 GitLab 顯示測試覆蓋率：以 Go 為例" property="og:title"><meta content="在 GitLab 顯示測試覆蓋率：以 Go 為例" name="twitter:title"><meta content="summary_large_image" name="twitter:card"><meta content="對現代開發者來講，單元測試已經不是可選，而是必備了。單元測試能保護程式碼，讓錯誤提早現形，也能讓重構時更安心。通常我們在評估單元測試的執行狀況時，會用 coverage 當成其中一項指標。當然，coverage 還是會有一些使用的場合跟侷限，當談到專案落地，可能大家會想知道的是，coverage 該怎麼使用，才能幫助到專案？…" name="description"><meta content="對現代開發者來講，單元測試已經不是可選，而是必備了。單元測試能保護程式碼，讓錯誤提早現形，也能讓重構時更安心。通常我們在評估單元測試的執行狀況時，會用 coverage 當成其中一項指標。當然，coverage 還是會有一些使用的場合跟侷限，當談到專案落地，可能大家會想知道的是，coverage 該怎麼使用，才能幫助到專案？…" name="twitter:description"><meta content="對現代開發者來講，單元測試已經不是可選，而是必備了。單元測試能保護程式碼，讓錯誤提早現形，也能讓重構時更安心。通常我們在評估單元測試的執行狀況時，會用 coverage 當成其中一項指標。當然，coverage 還是會有一些使用的場合跟侷限，當談到專案落地，可能大家會想知道的是，coverage 該怎麼使用，才能幫助到專案？…" property="og:description"><meta content="article" property="og:type"><meta content="https://blog.kenwsc.com/posts/2022/show-test-coverage-at-gitlab-a-go-example/" property="og:url"><meta content="Ken Chen's Blog" property="og:site_name"><meta content="https://blog.kenwsc.com/img/posts/2022/show-test-coverage-at-gitlab-a-go-example/cover.png" property="og:image"><meta content="https://blog.kenwsc.com/img/posts/2022/show-test-coverage-at-gitlab-a-go-example/cover.png" name="twitter:image"><meta content="hsZQwAip9iIbys-i4PJp_MfpNiA6w6RB0hYdWLiLUuk" name="google-site-verification"><link href="https://blog.kenwsc.com/posts/2022/show-test-coverage-at-gitlab-a-go-example/" rel="canonical"><meta content="always" name="referrer"><link href="/feed/feed.xml" rel="alternate" type="application/atom+xml" title="Ken Chen's Blog"><link href="/" rel="preconnect" crossorigin=""><script async="" src="/js/min.js?hash=7f26b2ece8" defer=""></script><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-G76M9XJCKN"></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-G76M9XJCKN');</script><script csp-hash="">if (/Mac OS X/.test(navigator.userAgent))document.documentElement.classList.add('apple')</script><style>:root{--primary-color: #5789d3;--primary-dark-color: #ffd349;--fgColor: #2f2f2f;--bgColor: linear-gradient(to top, #efefef, #ffffff);--primary: var(--primary-color);--primary-dark: var(--primary-dark-color);--fg: var(--fgColor);--bg: var(--bgColor);--progressColor: #ffd349;--main-width: calc(100vw - 3em)}main img{content-visibility:auto}article *{scroll-margin-top:50px}header nav{z-index:1;position:fixed;top:0;left:0;width:100vw;background:#fff;font-weight:200;text-align:right;padding:0}@media (min-width:37.5em){:root{--main-width: calc(37.5em - 3em)}}dialog,share-widget{position:fixed;opacity:.9}share-widget{right:20px;bottom:20px;width:50px;height:50px;border-radius:50%;overflow:hidden;box-shadow:2px 3px 5px 2px rgba(0,0,0,.2)}@media screen and (max-width:376px){share-widget{display:none}}share-widget div{margin-left:50%;transform:translateX(-50%);width:20px;height:20px;background-image:url(/img/share.svg);background-repeat:no-repeat;background-position:center;background-size:contain}.apple share-widget div{background-image:url(/img/share-apple.svg)}share-widget button{margin:0;padding:0;width:100%;height:100%;transition:.3s}share-widget button:active{transform:scale(1.2)}dialog{background-color:var(--primary-dark);z-index:1000;font-size:14px}#reading-progress{z-index:1;background-color:var(--progressColor);width:100vw;position:absolute;left:0;bottom:0;height:2px;transform:translate(-100vw,0);will-change:transform;pointer-events:none}#posts li{margin-bottom:.5em}button,html{line-height:1.15}html{-webkit-text-size-adjust:100%;font-family:"Open Sans",-apple-system,system-ui,BlinkMacSystemFont,"Segoe UI",Roboto,"Noto Sans","Helvetica Neue",Helvetica,Arial,"Noto Sans TC","PingFang TC","Hiragino Sans GB","Heiti TC","Microsoft YaHei","Microsoft Jhenghei",sans-serif;--font-family: "Open Sans", -apple-system, system-ui, BlinkMacSystemFont,
    "Segoe UI", Roboto, "Noto Sans", "Helvetica Neue", Helvetica, Arial,
    "Noto Sans TC", "PingFang TC", "Hiragino Sans GB", "Heiti TC",
    "Microsoft YaHei", "Microsoft Jhenghei", sans-serif}.article-footer img,body{margin:0}body.lock{overflow:hidden}a{background-color:transparent;text-underline-offset:2px;text-decoration:none;color:var(--primary)}b{font-weight:700}img{border-style:none;max-width:100%;height:auto;margin:0 auto}button{font-family:inherit;font-size:100%;overflow:visible;text-transform:none}[type=button],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details{display:block}h2{font-size:2.5em;line-height:1.2;margin-bottom:.6em;line-height:2.4rem;margin-bottom:1.36rem;font-size:1.728rem}body,p,pre,ul{font-size:1em}p,pre,ul{margin-bottom:1.5em}body,p,pre,ul{font-size:1rem;line-height:1.6}p,pre,ul{margin-bottom:1.36rem}@media (min-width:600px){h2{font-size:2.0097rem;line-height:2.52rem}body,p,pre,ul{font-size:1.1rem;line-height:1.6}h2,p,pre,ul{margin-bottom:1.496rem}}@media (min-width:1200px){h2{font-size:1.75rem}body,p,pre,ul{font-size:1.2rem;line-height:1.6}h2,p,pre,ul{margin-bottom:1.632rem}}code,pre{overflow-x:auto}pre{font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace}pre code:not([class]){overflow-x:scroll}button,code{border-radius:.3em}code{color:#e33671;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:90%}h1,h2{font-family:var(--font-family)}a:hover{text-decoration:underline}button{max-width:100%;background:#f2f2f2;color:#191919;cursor:pointer;padding:.75em 1.5em;text-align:center;margin:0 .75em 1.5em 0}button+label,label+*{page-break-before:always}button,label{display:inline-block}button:hover{background:#d9d9d9;color:#000}button:not([disabled]){background:#f9c412;color:#181818;background:var(--primary)}button:not([disabled]):hover{background:#ba9005;color:#000;background:var(--primary-dark)}*{border:0;box-sizing:border-box}body{font-family:var(--font-family);background:var(--bg);color:var(--fg)}header label{display:block}article,header{max-width:100%;width:42.5em;margin:0 auto}header{padding:4.5em 24px 0;text-align:center;display:flex;align-items:center;flex-direction:column}header p,ul{margin-top:0}header nav label{color:#000;cursor:pointer;margin:0;font-style:normal;text-align:right}main{max-width:70rem;margin:0 auto;min-height:60vh}article{padding:1.5em;word-break:break-word}li ul{margin-bottom:0}blockquote{padding:0 1.5em;margin:1.5em 0 1.5em 1.5em;border-left:4px solid var(--primary)}blockquote footer{background:0 0;display:block;color:#ccc;padding:.75em 0;font-size:90%;text-align:start}code[class*=language-],pre[class*=language-]{color:#ccc;background:0 0;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.doctype,.token.prolog{color:#999}.token.punctuation{color:#ccc}.token.attr-name,.token.tag{color:#e2777a}.token.function,.token.number{color:#f08d49}.token.class-name,.token.property{color:#f8c555}.token.atrule,.token.builtin{color:#cc99cd}.token.attr-value,.token.string{color:#7ec699}.token.operator,.token.url{color:#67cdcc}.token.bold{font-weight:700}.token.inserted{color:green}::-webkit-scrollbar-thumb:hover{background:var(--primary)}.w-full{width:100%}body.dark{--fg: var(--bgColor);--bg: var(--fgColor);--primary: var(--primary-dark-color)}@media (prefers-color-scheme:dark){body.dark{--fg: var(--bgColor);--bg: var(--fgColor);--primary: var(--primary-dark-color)}}h1{font-size:32px;line-height:1.25;margin:.67em 0;text-align:left}header aside{font-size:16px;color:#4b4b4b}#nav,.menu__btn{position:relative}.menu__btn{display:inline-block;width:24px;height:24px}.menu__btn span{opacity:0;width:1px;height:1px;overflow:hidden;display:block}.menu__btn::after,.menu__btn::before{content:"";position:absolute;top:51%;left:50%;height:2px;width:17px;background-color:#2d2d2d;border-radius:.1rem}.menu__btn::before{transform:translate(-50%,-50%);box-shadow:0 .3rem 0 #2d2d2d,0 -.3rem 0 #2d2d2d}.menu__btn::after{display:none;transform:translate(-50%,-50%) rotate(90deg)}.menu__btn.menu__btn--close{z-index:9;transform:rotate(45deg)}.menu__btn.menu__btn--close::before{box-shadow:none}.menu__btn.menu__btn--close::after{display:block}#nav{height:68px;z-index:2;align-items:center}.nav__links{display:none;flex-direction:column;position:fixed;z-index:3;top:0;left:0;right:0;bottom:0;padding:86px 48px 0;background-image:linear-gradient(to top,#efefef,#fff),linear-gradient(to bottom,#f9f9f9,#f9f9f9)}#nav,.nav__links--open{display:flex}.nav__links a{text-align:left;width:100%;padding:.5rem 0;transition:all .3s ease-out;font-weight:700;text-decoration:none;color:var(--fg)}.nav__links a:hover{color:var(--primary-color)}footer{margin-top:48px;font-size:14px;padding:24px;border-top:1px solid #ccc;text-align:center}.copyright{display:inline-block}footer>*{margin:.5em}.footer-logos{display:flex;align-items:center;justify-content:center}.footer-logos a:not(:first-child){margin-left:32px}.post-tags{display:flex;gap:0 16px;flex-wrap:wrap}.post-tag:not(body){text-decoration:none;background-color:#f5f5f5;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border-radius:20px;color:#4a4a4a;display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex;font-size:.75rem;height:2em;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;line-height:1.5;padding-left:.75em;padding-right:.75em;white-space:nowrap}.post-tag:hover{text-decoration:none;background:#ccc}.direct-link{display:none}.post-avatar{display:flex;align-items:center;height:36px}.post-avatar__time{font-size:13px}.article-footer{margin-top:40px;border-bottom:1px solid #ccc;padding-bottom:52px}.article-footer a{float:right;display:flex;align-items:center;color:var(--fg);font-weight:700;margin-left:4px}@media (min-width:768px){h1{font-size:48px}header aside{font-size:20px}header nav a:first-of-type{margin-left:auto}header nav a:last-of-type{margin-right:1.5em}.menu__btn{display:none}#nav,footer{max-width:1168px}#nav{height:80px;margin:0 auto}.nav__links{display:flex;flex-direction:row;position:static;padding:0;background-image:none}.nav__links a{text-align:center;margin-left:56px}footer{display:flex;flex-direction:row-reverse;justify-content:space-between;align-items:center;margin-left:auto;margin-right:auto}}</style></head><body><header><nav><div id="nav"><div class="nav__links"><a href="/" title="Homepage">Home</a> <a href="/archive/">Archive</a> <a href="/tags/">Tags</a> <a href="/about/">About</a></div></div><div id="reading-progress" aria-hidden="true"></div></nav><h1 class="w-full">在 GitLab 顯示測試覆蓋率：以 Go 為例</h1><aside class="w-full"><div class="post-avatar"><div class="post-avatar__time">Ken Chen | 02 Oct 2022 <a href="/tags/devops/" class="post-tag">DevOps</a> <a href="/tags/go/" class="post-tag">Go</a></div></div></aside><dialog id="message"></dialog></header><main><article><div id="post-page"></div><p>對現代開發者來講，單元測試已經不是可選，而是必備了。單元測試能保護程式碼，讓錯誤提早現形，也能讓重構時更安心。通常我們在評估單元測試的執行狀況時，會用 coverage 當成其中一項指標。當然，coverage 還是會有一些使用的場合跟侷限，當談到專案落地，可能大家會想知道的是，coverage 該怎麼使用，才能幫助到專案？</p><h2 id="%E9%96%8B%E7%99%BC%E3%80%81%E5%AF%A9%E6%9F%A5%E3%80%81%E5%9B%9E%E9%A1%A7"><a href="#%E9%96%8B%E7%99%BC%E3%80%81%E5%AF%A9%E6%9F%A5%E3%80%81%E5%9B%9E%E9%A1%A7" class="direct-link">#</a> 開發、審查、回顧</h2><p>我們先來看看什麼時候會需要知道 coverage？通常依照團隊的工作流程，將它分為三個階段：開發、審查、回顧。每個階段關注的場景會略有不同。</p><p>一個一個講。對開發中情形，開發者想知道的是剛寫完的邏輯是否能正常運行，有沒有對應的測試，覆蓋範圍是否已經足夠，如果還有條件分支沒覆蓋到的話，是哪裡？是不是每個錯誤都有處理了。這時最需要的是，codebase 要能 highlight 剛剛講的資訊，幫助開發者一眼掌握。</p><p>當開發完成，feature branch 被提交到原始碼管理系統，例如 GitLab，會需要一名 Reviewer 來負責審查。審查過程中，Reviewer 會看 coverage 來評估代碼品質，像是提交版本的覆蓋率是多少？跟前一版本比較起來，覆蓋率有沒有下降？哪些新寫的代碼是沒有覆蓋到的？</p><p><picture><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/2022/show-test-coverage-at-gitlab-a-go-example/gitlab-1-1920w.webp 1920w, /img/posts/2022/show-test-coverage-at-gitlab-a-go-example/gitlab-1-1280w.webp 1280w, /img/posts/2022/show-test-coverage-at-gitlab-a-go-example/gitlab-1-840w.webp 840w, /img/posts/2022/show-test-coverage-at-gitlab-a-go-example/gitlab-1-320w.webp 320w" type="image/webp"><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/2022/show-test-coverage-at-gitlab-a-go-example/gitlab-1-1920w.png 1920w, /img/posts/2022/show-test-coverage-at-gitlab-a-go-example/gitlab-1-1280w.png 1280w, /img/posts/2022/show-test-coverage-at-gitlab-a-go-example/gitlab-1-840w.png 840w, /img/posts/2022/show-test-coverage-at-gitlab-a-go-example/gitlab-1-320w.png 320w" type="image/png"><img alt="" height="279" src="/img/posts/2022/show-test-coverage-at-gitlab-a-go-example/gitlab-1-1920w.png" width="973" decoding="async" loading="lazy" style="background-size:cover;background-image:url(&#34;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 973 279'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23b)' preserveAspectRatio='none' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAECAIAAAAxsZngAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAYUlEQVQImVXM2wrAIAwDUP//O/cy2EWta1qtbqgwtvMSCCEOwJUSRIs1QKy2e2gfs3F00Xb4M5D34SSwFmYI8J1KVjNzqsLMWSWL5NJP6zCfptp642KkZT3WPTAGfvMHwAMR06NwZBRVWgAAAABJRU5ErkJggg=='%3E%3C/image%3E%3C/svg%3E&#34;)"></picture></p><p>而當專案進展到一個 Milestone，專案負責人想要回顧專案執行狀況，以安排接下來的計畫，這時會需要先蒐集一些資訊。通常 codebase 覆蓋率可能會被當成某種品質指標，用來放進關鍵結果中。</p><h2 id="%E8%A7%A3%E9%A1%8C%E6%80%9D%E8%B7%AF"><a href="#%E8%A7%A3%E9%A1%8C%E6%80%9D%E8%B7%AF" class="direct-link">#</a> 解題思路</h2><p>當我們釐清需求與場景後，接著可以來想解法了。</p><p>開發中的場景很單純，因為現在的 Editor 或 IDE 幾乎都有提供相關的插件，讓開發者能自行驗證，以 VSCode 來說，如果你有安裝官方的 Go 語言 Extension，它就能支援單元測試。如果你沒有，那也不要緊，因為 Go 已經幫你將測試工具整合進 CLI，只要自行呼叫就可以了。</p><pre class="language-bash"><code class="language-bash">~/git/ken/test-server: go <span class="token builtin class-name">test</span> -coverprofile<span class="token operator">=</span>c.out ./<span class="token punctuation">..</span>.                                                                                                <br>?       test-server     <span class="token punctuation">[</span>no <span class="token builtin class-name">test</span> files<span class="token punctuation">]</span><br>?       test-server/cmd/server  <span class="token punctuation">[</span>no <span class="token builtin class-name">test</span> files<span class="token punctuation">]</span><br>?       test-server/internal/config     <span class="token punctuation">[</span>no <span class="token builtin class-name">test</span> files<span class="token punctuation">]</span><br>?       test-server/internal/handler    <span class="token punctuation">[</span>no <span class="token builtin class-name">test</span> files<span class="token punctuation">]</span><br>ok      test-server/internal/service    <span class="token number">0</span>.437s  coverage: <span class="token number">88.2</span>% of statements</code></pre><p>審查中的場景比較麻煩，畢竟各家版控服務都不相同，需要在意的點也不同，以 GitLab 為例，Reviewer 需要知道的是 MR 時，整體的 coverage 有多少？哪些代碼有覆蓋哪些沒有？GitLab 文件中有兩個功能看起來不錯，第一個是 Merge request test coverage results，能抓出 coverage 的數值</p><blockquote><p>If you use test coverage in your code, you can use a regular expression to find coverage results in the job log. You can then include these results in the merge request in GitLab.</p></blockquote><p>第二個是 Test coverage visualization，能在 MR 的 diff view 中呈現覆蓋的程式碼</p><blockquote><p>With the help of <a href="https://docs.gitlab.com/ee/ci/index.html" rel="noopener noreferrer" target="_blank">GitLab CI/CD</a>, you can collect the test coverage information of your favorite testing or coverage-analysis tool, and visualize this information inside the file diff view of your merge requests (MRs). This will allow you to see which lines are covered by tests, and which lines still require coverage, before the MR is merged.</p></blockquote><p>效果類似這樣</p><p><picture><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/2022/show-test-coverage-at-gitlab-a-go-example/gitlab-2-1920w.webp 1920w, /img/posts/2022/show-test-coverage-at-gitlab-a-go-example/gitlab-2-1280w.webp 1280w, /img/posts/2022/show-test-coverage-at-gitlab-a-go-example/gitlab-2-840w.webp 840w, /img/posts/2022/show-test-coverage-at-gitlab-a-go-example/gitlab-2-320w.webp 320w" type="image/webp"><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/2022/show-test-coverage-at-gitlab-a-go-example/gitlab-2-1920w.png 1920w, /img/posts/2022/show-test-coverage-at-gitlab-a-go-example/gitlab-2-1280w.png 1280w, /img/posts/2022/show-test-coverage-at-gitlab-a-go-example/gitlab-2-840w.png 840w, /img/posts/2022/show-test-coverage-at-gitlab-a-go-example/gitlab-2-320w.png 320w" type="image/png"><img alt="" height="396" src="/img/posts/2022/show-test-coverage-at-gitlab-a-go-example/gitlab-2-1920w.png" width="1818" decoding="async" loading="lazy" style="background-size:cover;background-image:url(&#34;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 1818 396'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23b)' preserveAspectRatio='none' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAAECAIAAADnFEOFAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAgklEQVQImX3JuwrCQBBA0f14u2CX37HQJoWFYBckEDEP18zuzMqO+4yKYKUinOLCFTANXd8jYojBeeeDDzF8SpEssUG+sWUrjg/Z8lh3h1afRr5AQj2bb5BJJYJsVCKxKIuiXO6a/ZRQRvV6s/nt/g6xqqr1dlMPzdmB9Aoi6Xz97wlETL1rv5nm3gAAAABJRU5ErkJggg=='%3E%3C/image%3E%3C/svg%3E&#34;)"></picture></p><p>至於當我們需要回顧時，最好在專案首頁有一行類似 Metric 的字說明現況，即使沒接觸專案的人，也能知道專案的健康度。這個很適合用 Badge 來展現，通常 Badge 會貼在 Readme 上，而 Readme 會被 GitLab 自動放在專案首頁</p><p><picture><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/2022/show-test-coverage-at-gitlab-a-go-example/gitlab-3-1920w.webp 1920w, /img/posts/2022/show-test-coverage-at-gitlab-a-go-example/gitlab-3-1280w.webp 1280w, /img/posts/2022/show-test-coverage-at-gitlab-a-go-example/gitlab-3-840w.webp 840w, /img/posts/2022/show-test-coverage-at-gitlab-a-go-example/gitlab-3-320w.webp 320w" type="image/webp"><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/2022/show-test-coverage-at-gitlab-a-go-example/gitlab-3-1920w.png 1920w, /img/posts/2022/show-test-coverage-at-gitlab-a-go-example/gitlab-3-1280w.png 1280w, /img/posts/2022/show-test-coverage-at-gitlab-a-go-example/gitlab-3-840w.png 840w, /img/posts/2022/show-test-coverage-at-gitlab-a-go-example/gitlab-3-320w.png 320w" type="image/png"><img alt="" height="212" src="/img/posts/2022/show-test-coverage-at-gitlab-a-go-example/gitlab-3-1920w.png" width="979" decoding="async" loading="lazy" style="background-size:cover;background-image:url(&#34;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 979 212'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23b)' preserveAspectRatio='none' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAAECAIAAADnFEOFAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAXUlEQVQImY3NTQqAIBBAYe9/qggEW/SziSAyghZCC2esJHXAiS5QffvHE8YYh0hEIT5SivRFAMBm7RUC/ybqpl1V2VdKjVJ2hcaBmXPOb82ktVnmwyF6gN36dH5+bulKxNK7yx3WAAAAAElFTkSuQmCC'%3E%3C/image%3E%3C/svg%3E&#34;)"></picture></p><p>當然，如果可以，我們也會想分析專案的趨勢，是不是朝向健康的方向走，如果沒有，也許透過一些改善方式，例如講解 unit test 的概念、使用手法等等，來幫助團隊往前走。這時候 GitLab 的 Analytic 就很好用，可以用來觀察長期趨勢。</p><p><picture><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/2022/show-test-coverage-at-gitlab-a-go-example/gitlab-4-1920w.webp 1920w, /img/posts/2022/show-test-coverage-at-gitlab-a-go-example/gitlab-4-1280w.webp 1280w, /img/posts/2022/show-test-coverage-at-gitlab-a-go-example/gitlab-4-840w.webp 840w, /img/posts/2022/show-test-coverage-at-gitlab-a-go-example/gitlab-4-320w.webp 320w" type="image/webp"><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/2022/show-test-coverage-at-gitlab-a-go-example/gitlab-4-1920w.png 1920w, /img/posts/2022/show-test-coverage-at-gitlab-a-go-example/gitlab-4-1280w.png 1280w, /img/posts/2022/show-test-coverage-at-gitlab-a-go-example/gitlab-4-840w.png 840w, /img/posts/2022/show-test-coverage-at-gitlab-a-go-example/gitlab-4-320w.png 320w" type="image/png"><img alt="" height="545" src="/img/posts/2022/show-test-coverage-at-gitlab-a-go-example/gitlab-4-1920w.png" width="1851" decoding="async" loading="lazy" style="background-size:cover;background-image:url(&#34;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 1851 545'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23b)' preserveAspectRatio='none' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAECAIAAAAxsZngAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAgElEQVQImU3I0Q6CMAyF4b3/+2kgxgiaqBFYN6Ara7fWwIXx5Mu5+J0/BgAhQIwBcVWtZvpPJDNnR0Rmpmq1WqnGYjDrx+sAuxE0LAqzIZmbfHwO9f4ql4c0nbR9abp6vpWfti+na3lP1W0bj9PiA2LiNTGSJBI6PhEn2gsmzlm+96if94U5vF8AAAAASUVORK5CYII='%3E%3C/image%3E%3C/svg%3E&#34;)"></picture></p><h2 id="%E9%96%8B%E5%A7%8B%E5%8B%95%E6%89%8B"><a href="#%E9%96%8B%E5%A7%8B%E5%8B%95%E6%89%8B" class="direct-link">#</a> 開始動手</h2><p>方法擬定後，開始來動手吧。</p><p>假設你的 IDE 是 VSCode，可以到 Extension 安裝 Go 語言的延伸套件，然後在 test file 上應該能看到 run package tests，執行後專案內就會 highlight coverage，有覆蓋的部分是綠底，沒覆蓋則是紅底。</p><p><picture><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/2022/show-test-coverage-at-gitlab-a-go-example/gitlab-5-1920w.webp 1920w, /img/posts/2022/show-test-coverage-at-gitlab-a-go-example/gitlab-5-1280w.webp 1280w, /img/posts/2022/show-test-coverage-at-gitlab-a-go-example/gitlab-5-840w.webp 840w, /img/posts/2022/show-test-coverage-at-gitlab-a-go-example/gitlab-5-320w.webp 320w" type="image/webp"><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/2022/show-test-coverage-at-gitlab-a-go-example/gitlab-5-1920w.png 1920w, /img/posts/2022/show-test-coverage-at-gitlab-a-go-example/gitlab-5-1280w.png 1280w, /img/posts/2022/show-test-coverage-at-gitlab-a-go-example/gitlab-5-840w.png 840w, /img/posts/2022/show-test-coverage-at-gitlab-a-go-example/gitlab-5-320w.png 320w" type="image/png"><img alt="" height="361" src="/img/posts/2022/show-test-coverage-at-gitlab-a-go-example/gitlab-5-1920w.png" width="984" decoding="async" loading="lazy" style="background-size:cover;background-image:url(&#34;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 984 361'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23b)' preserveAspectRatio='none' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA0AAAAFCAIAAAAR2vFGAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAl0lEQVQImVWNyw6CMBRE+x30ddtbipcqbxIwNRoWmrDCuNf//wuDsPEsZhZzkmHHNJ3aNjb1UJ2Gqgo+y9CBBrmh9mYeXfAHY41UUnABWgOAAWOMsSuwBiKjceyer+n9uSzLeZ7rGD2RJ/pJ1trVRkTm2664P8rrLe/70NRUFmmeOyKltsv9mKFDT0FyLpJEcC6F2Eb9zxf74B2cS+io+gAAAABJRU5ErkJggg=='%3E%3C/image%3E%3C/svg%3E&#34;)"></picture></p><p>也可以在 Output Tab 看到呼叫指令</p><pre class="language-bash"><code class="language-bash">Running tool: C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>ken<span class="token punctuation">\</span>.g<span class="token punctuation">\</span>go<span class="token punctuation">\</span>bin<span class="token punctuation">\</span>go.exe <span class="token builtin class-name">test</span> -timeout 30s -coverprofile<span class="token operator">=</span>C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>ken<span class="token punctuation">\</span>AppData<span class="token punctuation">\</span>Local<span class="token punctuation">\</span>Temp<span class="token punctuation">\</span>vscode-goK1REdF<span class="token punctuation">\</span>go-code-cover ken-test/pkg/app/usecase<br><br>ok      ken-test/pkg/app/usecase    <span class="token number">0</span>.523s  coverage: <span class="token number">14.6</span>% of statements</code></pre><p>原理是用 UI 的方式調用底層的 go test，產生 coverprofile 後，再將它餵給 VSCode。</p><p>VSCode 怎麼知道 test 時經過哪些路徑呢？這裡的重點是 coverprofile，內容類似</p><pre class="language-bash"><code class="language-bash">mode: <span class="token builtin class-name">set</span><br>app-test/internal/app/usecase.go:12.92,14.16 <span class="token number">2</span> <span class="token number">0</span><br>app-test/internal/app/usecase.go:17.2,17.25 <span class="token number">1</span> <span class="token number">0</span><br>app-test/internal/app/usecase.go:14.16,16.3 <span class="token number">1</span> <span class="token number">0</span><br>app-test/internal/app/usecase.go:20.102,21.32 <span class="token number">1</span> <span class="token number">0</span></code></pre><p>Go 用來產生 coverprofile 的命令是</p><pre class="language-bash"><code class="language-bash">go <span class="token builtin class-name">test</span> -coverprofile<span class="token operator">=</span>coverage.txt ./<span class="token punctuation">..</span>.</code></pre><p>同理可證，如果 VSCode 吃 coverprofile 能 highlight coverage，只要餵 GitLab 同樣的檔案，GitLab 應該能做到同樣的效果。不過事情沒這麼美好。查詢說明文件，發現</p><blockquote><p>For the coverage analysis to work, you have to provide a properly formatted <a href="https://cobertura.github.io/cobertura/" rel="noopener noreferrer" target="_blank">Cobertura XML</a> report to <a href="https://docs.gitlab.com/ee/ci/yaml/artifacts_reports.html#artifactsreportscoverage_report" rel="noopener noreferrer" target="_blank">artifacts:reports:coverage_report</a>.</p></blockquote><p>意思是，原生的 coverprofile 格式，GitLab 是不接受的。需要將它轉換成 Cobertura format 並提供給 GitLab。</p><p>Cobertura 是什麼東西？參考 GitHub 的專案</p><blockquote><p>Cobertura is a free Java code coverage reporting tool. It is based on jcoverage 1.0.5. See the <a href="http://cobertura.sourceforge.net/" rel="noopener noreferrer" target="_blank">Cobertura web page</a> and <a href="https://github.com/cobertura/cobertura/wiki" rel="noopener noreferrer" target="_blank">wiki</a> for more details.</p></blockquote><p>Cobertura 是西班牙語 coverage 的意思，它是一套 Java 的 coverage 報告工具。Jenkins 使用它產出的報告來呈現 coverage，也因為 Jenkins 的使用者眾多，支援的場景比較齊全，GitLab 為了讓專案無痛轉換，也支援了 Cobertura 的格式，它的長相是這樣</p><pre class="language-xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?></span><br><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">coverage</span> <span class="token name">SYSTEM</span> <span class="token string">"[http://cobertura.sourceforge.net/xml/coverage-04.dtd](http://cobertura.sourceforge.net/xml/coverage-04.dtd)"</span><span class="token punctuation">></span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>coverage</span> <span class="token attr-name">line-rate</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0.21586345<span class="token punctuation">"</span></span> <span class="token attr-name">branch-rate</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">version</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">timestamp</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1664528908194<span class="token punctuation">"</span></span> <span class="token attr-name">lines-covered</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>215<span class="token punctuation">"</span></span> <span class="token attr-name">lines-valid</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>996<span class="token punctuation">"</span></span> <span class="token attr-name">branches-covered</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">branches-valid</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">complexity</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>sources</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>source</span><span class="token punctuation">></span></span>D:\git\ken\ken-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>source</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>sources</span><span class="token punctuation">></span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>packages</span><span class="token punctuation">></span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>package</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ken-test/pkg/app/repository<span class="token punctuation">"</span></span> <span class="token attr-name">line-rate</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0.30869564<span class="token punctuation">"</span></span> <span class="token attr-name">branch-rate</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">complexity</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>classes</span><span class="token punctuation">></span></span><br>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>class</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Sdk<span class="token punctuation">"</span></span> <span class="token attr-name">filename</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>pkg/app/repository/repo_data.go<span class="token punctuation">"</span></span> <span class="token attr-name">line-rate</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0.9423077<span class="token punctuation">"</span></span> <span class="token attr-name">branch-rate</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">complexity</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>methods</span><span class="token punctuation">></span></span><br>            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>method</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>GetDataPage<span class="token punctuation">"</span></span> <span class="token attr-name">signature</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">line-rate</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0.9423077<span class="token punctuation">"</span></span> <span class="token attr-name">branch-rate</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span> <span class="token attr-name">complexity</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><br>              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>lines</span><span class="token punctuation">></span></span><br>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>line</span> <span class="token attr-name">number</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>14<span class="token punctuation">"</span></span> <span class="token attr-name">hits</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>line</span><span class="token punctuation">></span></span><br>                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>line</span> <span class="token attr-name">number</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>15<span class="token punctuation">"</span></span> <span class="token attr-name">hits</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>line</span><span class="token punctuation">></span></span><br>...</code></pre><p>可以看出內容跟 Go 原生的 coverprofile 接近，只是改成用 XML 的格式。</p><p>要將 coverprofile 轉成 Cobertura，GitHub 有現成的工具</p><pre class="language-bash"><code class="language-bash">go <span class="token function">install</span> github.com/boumenot/gocover-cobertura@latest<br>gocover-cobertura <span class="token operator">&lt;</span> coverage.txt <span class="token operator">></span> coverage.xml</code></pre><p>轉換後，只要將這個檔案餵給 GitLab 就可以了。當然，我們希望這些事情都可以串進 CI Pipeline 自動完成，從 GitLab 的流程來思考的話，我們會需要個 test stage，該 stage 下有個 job，用來產出 coverage.xml，並將產出物提交給 GitLab Server，而 GitLab 自動根據這份文檔，顯示對應的資訊。</p><p>這些邏輯變成 gitlab-ci.yml 後，會是</p><pre class="language-yaml"><code class="language-yaml"><span class="token atrule key">stage</span><span class="token punctuation">:</span><br>  <span class="token punctuation">-</span> test<br><br><span class="token atrule key">code_coverage_report</span><span class="token punctuation">:</span><br>  <span class="token atrule key">stage</span><span class="token punctuation">:</span> test<br>  <span class="token atrule key">script</span><span class="token punctuation">:</span><br>    <span class="token punctuation">-</span> go test ./<span class="token punctuation">...</span> <span class="token punctuation">-</span>coverprofile=coverage.txt <span class="token punctuation">-</span>covermode count<br>    <span class="token punctuation">-</span> go install github.com/boumenot/gocover<span class="token punctuation">-</span>cobertura@latest<br>    <span class="token punctuation">-</span> $GOPATH/bin/gocover<span class="token punctuation">-</span>cobertura &lt; coverage.txt <span class="token punctuation">></span> coverage.xml<br>  <span class="token atrule key">artifacts</span><span class="token punctuation">:</span><br>    <span class="token atrule key">reports</span><span class="token punctuation">:</span><br>      <span class="token atrule key">cobertura</span><span class="token punctuation">:</span> coverage.xml </code></pre><p>關於 Badge 呢，如法炮製，加入一個 job 來處理，這個就比較單純了，因為 Badge 是由 GitLab Server 自己產生，我們只要更新它對應的變數就好，也就是只是要抓一個數字而已，它抓數字的方式也很有意思，是用 console output 跟 regexp 來抓，想想也挺合理，它不在乎你的輸出格式是什麼，也不在意怎麼 Parse，只要告訴它要抓的值就可以，這樣的設計為不同語言都提供了彈性。</p><pre class="language-yaml"><code class="language-yaml"><span class="token atrule key">coverage</span><span class="token punctuation">:</span><br>  <span class="token atrule key">stage</span><span class="token punctuation">:</span> test<br>  <span class="token atrule key">script</span><span class="token punctuation">:</span><br>  <span class="token punctuation">-</span> go tool cover <span class="token punctuation">-</span>func=coverage.txt<br>  <span class="token atrule key">coverage</span><span class="token punctuation">:</span> <span class="token string">'/total:\s+\(statements\)\s+(\d+.\d+\%)/'</span></code></pre><p>當然最後不要忘記，Readme 中要加上 Badge</p><pre class="language-markdown"><code class="language-markdown"><span class="token url">[<span class="token content">![Coverage Report</span>](<span class="token url">&lt;https://gitlab.com/ken00535/demo-tools/badges/master/coverage.svg></span>)</span>](&lt;https://gitlab.com/ken00535/demo-tools/commits/master>)</code></pre><h2 id="%E7%B5%90%E8%AA%9E"><a href="#%E7%B5%90%E8%AA%9E" class="direct-link">#</a> 結語</h2><p>簡單說明由需求到落地的思考過程。這套思路是用資訊架構三本柱的「場景」「使用者」「內容」來分的，嘗試先定義出場景跟使用者關心的事，再來補齊相關的內容。不得不說確實好用，當場景拆解出來後，要求的資訊也跟著水落石出。例如我原本沒想過用 Cobertura 的格式，可是當知道需要顯示 Line Hit 時，就開始研究其他家的做法，也開始好奇 Go 的 Built-in Tool 有沒有支援類似的場景。</p><p>我猜 coverage 應該還有些不同的應用，像是不單判斷有沒有覆蓋，還更進一步用 heatmap 來呈現；或者是將 coverage trend 跟 issues 的發生頻率做比對，證明 unit test 對品質的有效性。希望大家看完這篇後，也能找到適合自己團隊的用法。</p><h2 id="reference"><a href="#reference" class="direct-link">#</a> Reference</h2><ul><li><a href="https://docs.gitlab.com/ee/ci/pipelines/settings.html#merge-request-test-coverage-results" rel="noopener noreferrer" target="_blank">Customize pipeline configuration | GitLab</a></li><li><a href="https://docs.gitlab.com/ee/ci/testing/test_coverage_visualization.html" rel="noopener noreferrer" target="_blank">Test coverage visualization | GitLab</a></li><li><a href="https://github.com/cobertura/cobertura" rel="noopener noreferrer" target="_blank">GitHub - cobertura/cobertura: Cobertura</a></li></ul><div class="article-footer"></div><div><p style="font-weight: bold;">標籤</p><div class="post-tags"><a href="/tags/devops/" class="post-tag">DevOps</a> <a href="/tags/go/" class="post-tag">Go</a></div><p style="font-weight: bold;">其他文章</p><ul><li><a href="/posts/2020/code-generator-by-go-template/">自動生成重複代碼：使用 Go 的 Template</a></li><li><a href="/posts/2020/how-to-authenticate-user-using-jwt/">如何驗證使用者身分：使用 JWT</a></li><li><a href="/posts/2020/go-generic-alter-plan-assert-and-codegen/">Go 的泛型替代方案：型別斷言與代碼生成</a></li><li><a href="/posts/2020/develop-your-middleware-by-golang/">訊息的處理架構：路由與中間層模式</a></li><li><a href="/posts/2019/setup-openwrt-on-virtualbox/">在 VirtualBox 上建置 Openwrt</a></li></ul></div><p style="font-weight: bold;">評論</p><script async="" src="https://utteranc.es/client.js" crossorigin="anonymous" id="utterance-script" issue-term="title" label="utterance" repo="ken00535/blog" theme="github-light"></script><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"在 GitLab 顯示測試覆蓋率：以 Go 為例","image":["https://blog.kenwsc.com/img/posts/2022/show-test-coverage-at-gitlab-a-go-example/gitlab-1-1920w.png","https://blog.kenwsc.com/img/posts/2022/show-test-coverage-at-gitlab-a-go-example/gitlab-2-1920w.png","https://blog.kenwsc.com/img/posts/2022/show-test-coverage-at-gitlab-a-go-example/gitlab-3-1920w.png","https://blog.kenwsc.com/img/posts/2022/show-test-coverage-at-gitlab-a-go-example/gitlab-4-1920w.png","https://blog.kenwsc.com/img/posts/2022/show-test-coverage-at-gitlab-a-go-example/gitlab-5-1920w.png"],"author":{"@type":"Person","name":""},"publisher":{"@type":"Organization","name":"Ken Chen&#39;s Blog","url":"https://blog.kenwsc.com","logo":{"@type":"ImageObject","url":"https://blog.kenwsc.com/img/favicon/favicon.png","width":512,"height":512}},"url":"https://blog.kenwsc.com/posts/2022/show-test-coverage-at-gitlab-a-go-example/","mainEntityOfPage":"https://blog.kenwsc.com/posts/2022/show-test-coverage-at-gitlab-a-go-example/","datePublished":"2022-10-02","dateModified":"2022-12-12","description":"對現代開發者來講，單元測試已經不是可選，而是必備了。單元測試能保護程式碼，讓錯誤提早現形，也能讓重構時更安心。通常我們在評估單元測試的執行狀況時，會用 coverage 當成其中一項指標。當然，coverage..."}</script></article></main><footer><div class="footer-logos"><a href="https://medium.com/@ken00535" rel="noopener noreferrer" target="_blank"><img alt="medium" height="50" src="/img/icons/icon_social media_medium.svg" width="50"></a><a href="https://www.linkedin.com/in/ken00535" rel="noopener noreferrer" target="_blank"><img alt="linkedin" height="30" src="/img/icons/icon_social media_linkedln.svg" width="30"></a><a href="https://blog.kenwsc.com/feed/feed.xml" rel="noreferrer noopener" target="_blank"><img alt="rss feed" height="30" src="/img/icons/rss-feed.svg" width="30"></a></div><div class="copyright">© 2022 Ken Chen's Blog, Powered by <a href="https://github.com/google/eleventy-high-performance-blog" rel="noopener noreferrer" target="_blank">eleventy-high-performance-blog</a></div></footer><script>// light/dark theme switch
      // disable dark mode for now
      const menuBtn = document.querySelector('.menu__btn')
      menuBtn.addEventListener('click', function() {
        document.querySelector('body').classList.toggle('lock')
        menuBtn.classList.toggle('menu__btn--close');
        document.querySelector('.nav__links').classList.toggle('nav__links--open')
      })</script></body></html>