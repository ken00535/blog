<!DOCTYPE html><html domain="blog.kenwsc.com" ga-id="G-G76M9XJCKN" lang="zh-TW"><head><meta charset="utf-8"><meta content="width=device-width,initial-scale=1" name="viewport"><meta content="Backend,Golang" name="keywords"><link href="/img/favicon/favicon.png?hash=b6fc65e341" rel="icon" type="image/png"><meta content="#5789d3" name="theme-color"><title>GORM：從建置到 CRUD</title><meta content="GORM：從建置到 CRUD" property="og:title"><meta content="GORM：從建置到 CRUD" name="twitter:title"><meta content="summary_large_image" name="twitter:card"><meta content="Golang 有許多第三方的 ORM 套件，例如 lib/pq、go-pg、gorm、pgx，其中 gorm 是 GitHub 上星星數較多的專案，而且能對應到不同類型的資料庫，在 Golang 中常被使用。本文會講解如何使用 gorm 來操作 Postgres，順帶走一次後端資料庫開發的基本流程。…" name="description"><meta content="Golang 有許多第三方的 ORM 套件，例如 lib/pq、go-pg、gorm、pgx，其中 gorm 是 GitHub 上星星數較多的專案，而且能對應到不同類型的資料庫，在 Golang 中常被使用。本文會講解如何使用 gorm 來操作 Postgres，順帶走一次後端資料庫開發的基本流程。…" name="twitter:description"><meta content="Golang 有許多第三方的 ORM 套件，例如 lib/pq、go-pg、gorm、pgx，其中 gorm 是 GitHub 上星星數較多的專案，而且能對應到不同類型的資料庫，在 Golang 中常被使用。本文會講解如何使用 gorm 來操作 Postgres，順帶走一次後端資料庫開發的基本流程。…" property="og:description"><meta content="article" property="og:type"><meta content="https://blog.kenwsc.com/posts/2020/gorm-from-init-to-use/" property="og:url"><meta content="Ken Chen's Blog" property="og:site_name"><meta content="https://blog.kenwsc.com/img/posts/2020/gorm-from-init-to-use/cover.png" property="og:image"><meta content="https://blog.kenwsc.com/img/posts/2020/gorm-from-init-to-use/cover.png" name="twitter:image"><meta content="hsZQwAip9iIbys-i4PJp_MfpNiA6w6RB0hYdWLiLUuk" name="google-site-verification"><link href="https://blog.kenwsc.com/posts/2020/gorm-from-init-to-use/" rel="canonical"><meta content="always" name="referrer"><link href="/feed/feed.xml" rel="alternate" type="application/atom+xml" title="Ken Chen's Blog"><link href="/" rel="preconnect" crossorigin=""><script async="" src="/js/min.js?hash=7f26b2ece8" defer=""></script><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-G76M9XJCKN"></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-G76M9XJCKN');</script><script csp-hash="">if (/Mac OS X/.test(navigator.userAgent))document.documentElement.classList.add('apple')</script><style>:root{--primary-color: #5789d3;--primary-dark-color: #ffd349;--fgColor: #2f2f2f;--bgColor: linear-gradient(to top, #efefef, #ffffff);--primary: var(--primary-color);--primary-dark: var(--primary-dark-color);--fg: var(--fgColor);--bg: var(--bgColor);--progressColor: #ffd349;--main-width: calc(100vw - 3em)}main img{content-visibility:auto}article *{scroll-margin-top:50px}header nav{z-index:1;position:fixed;top:0;left:0;width:100vw;background:#fff;font-weight:200;text-align:right;padding:0}@media (min-width:37.5em){:root{--main-width: calc(37.5em - 3em)}}dialog,share-widget{position:fixed;opacity:.9}share-widget{right:20px;bottom:20px;width:50px;height:50px;border-radius:50%;overflow:hidden;box-shadow:2px 3px 5px 2px rgba(0,0,0,.2)}@media screen and (max-width:376px){share-widget{display:none}}share-widget div{margin-left:50%;transform:translateX(-50%);width:20px;height:20px;background-image:url(/img/share.svg);background-repeat:no-repeat;background-position:center;background-size:contain}.apple share-widget div{background-image:url(/img/share-apple.svg)}share-widget button{margin:0;padding:0;width:100%;height:100%;transition:.3s}share-widget button:active{transform:scale(1.2)}dialog{background-color:var(--primary-dark);z-index:1000;font-size:14px}#reading-progress{z-index:1;background-color:var(--progressColor);width:100vw;position:absolute;left:0;bottom:0;height:2px;transform:translate(-100vw,0);will-change:transform;pointer-events:none}#posts li{margin-bottom:.5em}html{line-height:1.15;-webkit-text-size-adjust:100%;font-family:"Open Sans",-apple-system,system-ui,BlinkMacSystemFont,"Segoe UI",Roboto,"Noto Sans","Helvetica Neue",Helvetica,Arial,"Noto Sans TC","PingFang TC","Hiragino Sans GB","Heiti TC","Microsoft YaHei","Microsoft Jhenghei",sans-serif;--font-family: "Open Sans", -apple-system, system-ui, BlinkMacSystemFont,
    "Segoe UI", Roboto, "Noto Sans", "Helvetica Neue", Helvetica, Arial,
    "Noto Sans TC", "PingFang TC", "Hiragino Sans GB", "Heiti TC",
    "Microsoft YaHei", "Microsoft Jhenghei", sans-serif}.article-footer img,body{margin:0}body.lock{overflow:hidden}a{background-color:transparent;text-underline-offset:2px;text-decoration:none;color:var(--primary)}b{font-weight:700}img{border-style:none;max-width:100%;height:auto;margin:0 auto}button,select{font-family:inherit;font-size:100%;line-height:1.15;text-transform:none}button{overflow:visible}select{margin:0}[type=button],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}h2{font-size:2.5em;line-height:1.2;margin-bottom:.6em;line-height:2.4rem;margin-bottom:1.36rem;font-size:1.728rem}body,p,pre,ul{font-size:1em}p,pre,ul{margin-bottom:1.5em}body,p,pre,ul{font-size:1rem;line-height:1.6}p,pre,ul{margin-bottom:1.36rem}@media (min-width:600px){h2{font-size:2.0097rem;line-height:2.52rem}body,p,pre,ul{font-size:1.1rem;line-height:1.6}h2,p,pre,ul{margin-bottom:1.496rem}}@media (min-width:1200px){h2{font-size:1.75rem}body,p,pre,ul{font-size:1.2rem;line-height:1.6}h2,p,pre,ul{margin-bottom:1.632rem}}code,pre{overflow-x:auto}pre{font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace}pre code:not([class]){overflow-x:scroll}code{border-radius:.3em;color:#e33671;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:90%}h1,h2{font-family:var(--font-family)}a:hover{text-decoration:underline}button,select{border-radius:.3em;max-width:100%}button+label,label+*,select+label{page-break-before:always}select{margin-bottom:1.5em;display:inline;border:1px solid #595959;padding:.75em}button,label{display:inline-block}button{background:#f2f2f2;color:#191919;cursor:pointer;padding:.75em 1.5em;text-align:center;margin:0 .75em 1.5em 0}button:hover{background:#d9d9d9;color:#000}button:not([disabled]){background:#f9c412;color:#181818;background:var(--primary)}button:not([disabled]):hover{background:#ba9005;color:#000;background:var(--primary-dark)}*{border:0;box-sizing:border-box}body{font-family:var(--font-family);background:var(--bg);color:var(--fg)}header label{display:block}article,header{max-width:100%;width:42.5em;margin:0 auto}header{padding:4.5em 24px 0;text-align:center;display:flex;align-items:center;flex-direction:column}header p,ul{margin-top:0}header nav label{color:#000;cursor:pointer;margin:0;font-style:normal;text-align:right}main{max-width:70rem;margin:0 auto;min-height:60vh}article{padding:1.5em;word-break:break-word}li ul{margin-bottom:0}blockquote{padding:0 1.5em;margin:1.5em 0 1.5em 1.5em;border-left:4px solid var(--primary)}blockquote footer{background:0 0;display:block;color:#ccc;padding:.75em 0;font-size:90%;text-align:start}code[class*=language-],pre[class*=language-]{color:#ccc;background:0 0;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.comment{color:#999}.token.punctuation{color:#ccc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.property{color:#f8c555}.token.builtin,.token.keyword{color:#cc99cd}.token.string{color:#7ec699}.token.operator,.token.url{color:#67cdcc}.token.bold{font-weight:700}.token.inserted{color:green}::-webkit-scrollbar-thumb:hover{background:var(--primary)}.w-full{width:100%}body.dark{--fg: var(--bgColor);--bg: var(--fgColor);--primary: var(--primary-dark-color)}@media (prefers-color-scheme:dark){body.dark{--fg: var(--bgColor);--bg: var(--fgColor);--primary: var(--primary-dark-color)}}h1{font-size:32px;line-height:1.25;margin:.67em 0;text-align:left}header aside{font-size:16px;color:#4b4b4b}#nav,.menu__btn{position:relative}.menu__btn{display:inline-block;width:24px;height:24px}.menu__btn span{opacity:0;width:1px;height:1px;overflow:hidden;display:block}.menu__btn::after,.menu__btn::before{content:"";position:absolute;top:51%;left:50%;height:2px;width:17px;background-color:#2d2d2d;border-radius:.1rem}.menu__btn::before{transform:translate(-50%,-50%);box-shadow:0 .3rem 0 #2d2d2d,0 -.3rem 0 #2d2d2d}.menu__btn::after{display:none;transform:translate(-50%,-50%) rotate(90deg)}.menu__btn.menu__btn--close{z-index:9;transform:rotate(45deg)}.menu__btn.menu__btn--close::before{box-shadow:none}.menu__btn.menu__btn--close::after{display:block}#nav{height:68px;z-index:2;align-items:center}.nav__links{display:none;flex-direction:column;position:fixed;z-index:3;top:0;left:0;right:0;bottom:0;padding:86px 48px 0;background-image:linear-gradient(to top,#efefef,#fff),linear-gradient(to bottom,#f9f9f9,#f9f9f9)}#nav,.nav__links--open{display:flex}.nav__links a{text-align:left;width:100%;padding:.5rem 0;transition:all .3s ease-out;font-weight:700;text-decoration:none;color:var(--fg)}.nav__links a:hover{color:var(--primary-color)}footer{margin-top:48px;font-size:14px;padding:24px;border-top:1px solid #ccc;text-align:center}.copyright{display:inline-block}footer>*{margin:.5em}.footer-logos{display:flex;align-items:center;justify-content:center}.footer-logos a:not(:first-child){margin-left:32px}.post-tags{display:flex;gap:0 16px;flex-wrap:wrap}.post-tag:not(body){text-decoration:none;background-color:#f5f5f5;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border-radius:20px;color:#4a4a4a;display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex;font-size:.75rem;height:2em;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;line-height:1.5;padding-left:.75em;padding-right:.75em;white-space:nowrap}.post-tag:hover{text-decoration:none;background:#ccc}.direct-link{display:none}.post-avatar{display:flex;align-items:center;height:36px}.post-avatar__time{font-size:13px}.article-footer{margin-top:40px;border-bottom:1px solid #ccc;padding-bottom:52px}.article-footer a{float:right;display:flex;align-items:center;color:var(--fg);font-weight:700;margin-left:4px}@media (min-width:768px){h1{font-size:48px}header aside{font-size:20px}header nav a:first-of-type{margin-left:auto}header nav a:last-of-type{margin-right:1.5em}.menu__btn{display:none}#nav,footer{max-width:1168px}#nav{height:80px;margin:0 auto}.nav__links{display:flex;flex-direction:row;position:static;padding:0;background-image:none}.nav__links a{text-align:center;margin-left:56px}footer{display:flex;flex-direction:row-reverse;justify-content:space-between;align-items:center;margin-left:auto;margin-right:auto}}</style></head><body><header><nav><div id="nav"><div class="nav__links"><a href="/" title="Homepage">Home</a> <a href="/archive/">Archive</a> <a href="/tags/">Tags</a> <a href="/about/">About</a></div></div><div id="reading-progress" aria-hidden="true"></div></nav><h1 class="w-full">GORM：從建置到 CRUD</h1><aside class="w-full"><div class="post-avatar"><div class="post-avatar__time">Ken Chen | 26 Jul 2020 <a href="/tags/go/" class="post-tag">Go</a> <a href="/tags/database/" class="post-tag">Database</a></div></div></aside><dialog id="message"></dialog></header><main><article><div id="post-page"></div><p>進行後端開發時，少不了要使用資料庫，由於資料庫的設計與使用方式偏向函數思維，跟主流的物件導向習慣不同，因此很多語言都有對應的 ORM 套件，用來將資料庫轉為物件，方便開發者使用。</p><p>Golang 同樣有許多第三方的 ORM 套件，例如 lib/pq、go-pg、gorm、pgx，其中 <a href="https://github.com/go-gorm/gorm" rel="noopener noreferrer" target="_blank">gorm</a> 是 GitHub 上星星數較多的專案，而且能對應到不同類型的資料庫，在 Golang 中常被使用。本文會講解如何使用 gorm 來操作 Postgres，順帶走一次後端資料庫開發的基本流程。</p><h2 id="establish-database"><a href="#establish-database" class="direct-link">#</a> Establish Database</h2><p>既然要使用 ORM 來開發資料庫，當然要先有資料庫啦。Postgres 是常用到的關聯式資料，它是 web based，支援高併發，相對傳統的 SQLite 等 file based 的資料庫，更適合網路應用。</p><p>要安裝 Postgres，可以用</p><pre class="language-bash"><code class="language-bash">choco <span class="token function">install</span> postgresql -y</code></pre><p>安裝包會安裝 Postgres 的程式本體，還有一些命令行工具，使用這些工具可以不用進到 Postgres 的互動介面，就能操作資料庫。</p><p>接著，在專案目錄下新增資料庫資料夾，存放資料以及相關檔案</p><pre><code>project
├── cmd
├── data
│   └── postgres
├── pkg
├── scripts
├── go.mod
└── README.md
</code></pre><p>使用命令行工具 initdb 來初始化資料庫</p><pre class="language-bash"><code class="language-bash">initdb.exe -D ./data/postgres -U postgres</code></pre><p>-D 是指定資料夾；-U 是指定 user。初始化後，可以看到 data/postgres 資料夾下產生出許多新檔案。</p><p>有資料庫後，要將這個資料庫的服務連上網路，讓使用者使用。可以用命令行工具 pg_ctl 來執行</p><pre class="language-bash"><code class="language-bash">pg_ctl.exe -D ./data/postgres -l logfile start</code></pre><p>-l 是 log 的位置。</p><p>執行後可以看到</p><pre class="language-bash"><code class="language-bash">waiting <span class="token keyword">for</span> server to start<span class="token punctuation">..</span><span class="token punctuation">..</span> <span class="token keyword">done</span><br>server started</code></pre><p>伺服器啟動成功。</p><p>在開始使用資料庫前，需要先制定資料庫的表格結構(schema)，告訴使用者資料庫有哪些欄位，資料格式是什麼，這些資料定義語言通常會用 sql 描述。</p><p>為做到這件事，在 scripts 中建立一個 sql 檔案</p><pre><code>project
├── cmd
├── data
│   └── postgres
├── pkg
├── scripts
│   └── postgres
│       └── initialize.sql
├── go.mod
└── README.md
</code></pre><p>內容是</p><pre class="language-sql"><code class="language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> players <span class="token punctuation">(</span><br>    id <span class="token keyword">SERIAL</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span><br>    age <span class="token keyword">SMALLINT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span><br>    username <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span><br>    budget <span class="token keyword">INTEGER</span><br><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>意思是要創建一張名為 players 的表格，用來記錄比賽選手的資料。表格中有 id、age、username、budget 四個欄位。其中 id 是會自行增加的整數，也是主 key，用來當索引；age 是整數，不得為空；username 是字串，長度最多 50，不得為空；budget 是整數。</p><p>接著用 psql 來操作 sql</p><pre class="language-bash"><code class="language-bash">psql -U postgres -d postgres -f scripts/postgres/initialize.sql</code></pre><p>執行後，剛剛的 sql 生效，資料庫初始化完成。</p><h2 id="connect-with-pgadmin"><a href="#connect-with-pgadmin" class="direct-link">#</a> Connect with pgadmin</h2><p>雖然說資料庫初始化完成，但看不到實體，還是沒有實感。這時可以先用互動式的命令行界面來看</p><pre class="language-bash"><code class="language-bash">psql -U postgres</code></pre><p>登入後，輸入搜尋語句</p><pre class="language-sql"><code class="language-sql">postgres<span class="token operator">=</span><span class="token comment"># select * from players;</span><br>id <span class="token operator">|</span> age <span class="token operator">|</span> username <span class="token operator">|</span> budget<br><span class="token comment">----+-----+----------+--------</span><br><span class="token punctuation">(</span><span class="token number">0</span> <span class="token keyword">rows</span><span class="token punctuation">)</span></code></pre><p>如搜尋結果，表格格式跟剛剛創建的相同。</p><p>但如果每次查詢都要用命令行，需要記憶大量指令，操作起來不直覺，好在 Postgres 也有提供 GUI 讓使用者操作，安裝可以用</p><pre class="language-bash"><code class="language-bash">choco <span class="token function">install</span> pgadmin4 -y</code></pre><p><picture><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/2020/gorm-from-init-to-use/gorm-1-1920w.webp 1920w, /img/posts/2020/gorm-from-init-to-use/gorm-1-1280w.webp 1280w, /img/posts/2020/gorm-from-init-to-use/gorm-1-840w.webp 840w, /img/posts/2020/gorm-from-init-to-use/gorm-1-320w.webp 320w" type="image/webp"><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/2020/gorm-from-init-to-use/gorm-1-1920w.png 1920w, /img/posts/2020/gorm-from-init-to-use/gorm-1-1280w.png 1280w, /img/posts/2020/gorm-from-init-to-use/gorm-1-840w.png 840w, /img/posts/2020/gorm-from-init-to-use/gorm-1-320w.png 320w" type="image/png"><img alt="" height="322" src="/img/posts/2020/gorm-from-init-to-use/gorm-1-1920w.png" width="785" decoding="async" loading="lazy" style="background-size:cover;background-image:url(&#34;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 785 322'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23b)' preserveAspectRatio='none' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAFCAIAAAD+GJp4AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAsElEQVQImR3Muw6CMBhA4b4rtCIiPJezm5fFxcQ4OAAJoCaGizUR2nIRWoHfy5m/HGRYtmPb5tSYWzPTMDDGhBCC8YRgXdN0TXMcBy12/vJwXrt04z22PuVNBzBK1a+OUd1KAGCMob17PV3uXpz7ceHF+Uu+AaCTMrplnfyhsixRGAQ0S9qmqktRcaaUAoBxHJVsh74HACEECqMoSVNKKeOcsaJp5TMvBOfDMMC/7+kDTzyT5SMEFD0AAAAASUVORK5CYII='%3E%3C/image%3E%3C/svg%3E&#34;)"></picture></p><p>安裝好後啟動，可以再右下角看到 pgAdmin4 的圖案</p><p>由於 pgAdmin4 是 web based 的客戶端，啟動後會開啟瀏覽器網頁。可以用 Create Server 將剛剛創建好的資料庫加入</p><p><picture><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/2020/gorm-from-init-to-use/gorm-2-1920w.webp 1920w, /img/posts/2020/gorm-from-init-to-use/gorm-2-1280w.webp 1280w, /img/posts/2020/gorm-from-init-to-use/gorm-2-840w.webp 840w, /img/posts/2020/gorm-from-init-to-use/gorm-2-320w.webp 320w" type="image/webp"><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/2020/gorm-from-init-to-use/gorm-2-1920w.png 1920w, /img/posts/2020/gorm-from-init-to-use/gorm-2-1280w.png 1280w, /img/posts/2020/gorm-from-init-to-use/gorm-2-840w.png 840w, /img/posts/2020/gorm-from-init-to-use/gorm-2-320w.png 320w" type="image/png"><img alt="" height="196" src="/img/posts/2020/gorm-from-init-to-use/gorm-2-1920w.png" width="888" decoding="async" loading="lazy" style="background-size:cover;background-image:url(&#34;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 888 196'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23b)' preserveAspectRatio='none' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAECAIAAAAI1ii7AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAuklEQVQImW3GTQsBQRgA4P3JyuLmwh3JcsCBUooYGwnZg68kFC5SiAPvfsy2M5kZa2uUs3oOj1LsLlONSaY5zbbmicowWR3FSz1VQxENqRpSc+1YQY/mO+FcK5LXQ1mk7K4w3t8G23N3dbqAC5jY2BNccMY5E+zFfxfsxQhlYHvKDdz+Ym+sj7PDtTbaFNAsXTfKveX94VqYgkPAJuAQ06GmQyxMFSnlm7Pg40sphR8IPwDbuz+xhelfX4edn0xFyIFyAAAAAElFTkSuQmCC'%3E%3C/image%3E%3C/svg%3E&#34;)"></picture></p><p>輸入帳號密碼後連線</p><p><picture><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/2020/gorm-from-init-to-use/gorm-3-1920w.webp 1920w, /img/posts/2020/gorm-from-init-to-use/gorm-3-1280w.webp 1280w, /img/posts/2020/gorm-from-init-to-use/gorm-3-840w.webp 840w, /img/posts/2020/gorm-from-init-to-use/gorm-3-320w.webp 320w" type="image/webp"><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/2020/gorm-from-init-to-use/gorm-3-1920w.png 1920w, /img/posts/2020/gorm-from-init-to-use/gorm-3-1280w.png 1280w, /img/posts/2020/gorm-from-init-to-use/gorm-3-840w.png 840w, /img/posts/2020/gorm-from-init-to-use/gorm-3-320w.png 320w" type="image/png"><img alt="" height="555" src="/img/posts/2020/gorm-from-init-to-use/gorm-3-1920w.png" width="505" decoding="async" loading="lazy" style="background-size:cover;background-image:url(&#34;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 505 555'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23b)' preserveAspectRatio='none' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAAICAIAAAC6ZnJRAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAj0lEQVQImSXMwQ2DMAxG4ew/SJfoDh2gh5aKCkggIXYc+08QUoUqvdN3eG7xYVmTAgao2XmeBrhxCvO677kUMS5arVFR9x7nsGWWin6gdfSDRd1rmPxGW6JSUSpEWyJxn69fIoXEkWqkmlh95EtjlmpNFFeGmMVNPsVcWex/sNaB5lhUFIYj7ZyJn8N8uz9+eoOd1yqCTysAAAAASUVORK5CYII='%3E%3C/image%3E%3C/svg%3E&#34;)"></picture></p><p>在左邊的專案樹中出現連線到的 Server，底下能看到創建好的表格</p><p><picture><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/2020/gorm-from-init-to-use/gorm-4-1920w.webp 1920w, /img/posts/2020/gorm-from-init-to-use/gorm-4-1280w.webp 1280w, /img/posts/2020/gorm-from-init-to-use/gorm-4-840w.webp 840w, /img/posts/2020/gorm-from-init-to-use/gorm-4-320w.webp 320w" type="image/webp"><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/2020/gorm-from-init-to-use/gorm-4-1920w.png 1920w, /img/posts/2020/gorm-from-init-to-use/gorm-4-1280w.png 1280w, /img/posts/2020/gorm-from-init-to-use/gorm-4-840w.png 840w, /img/posts/2020/gorm-from-init-to-use/gorm-4-320w.png 320w" type="image/png"><img alt="" height="831" src="/img/posts/2020/gorm-from-init-to-use/gorm-4-1920w.png" width="572" decoding="async" loading="lazy" style="background-size:cover;background-image:url(&#34;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 572 831'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23b)' preserveAspectRatio='none' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAYAAAAJCAIAAACe+MrKAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAjklEQVQImR3KOw7CMAwA0Nz/WEwIBgYYkCp1gEr9uEltx8qndRJU1qdnwNoQo2pB8kgcQjQpRQBba/kraSlG9YBlZOKcd0cC1pvWmjDDAki8cZhWOomEmbDo4SUSh5Mc4e3Z3d+f66u/PDqTSnOS+mGaN/mO6zDbc4UUkbdam0OxKGbPaXWgqloqOA/O/wA/z5jUrebCnwAAAABJRU5ErkJggg=='%3E%3C/image%3E%3C/svg%3E&#34;)"></picture></p><p>選擇 All Rows 後，就能瀏覽現在有的資料</p><p><picture><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/2020/gorm-from-init-to-use/gorm-5-1920w.webp 1920w, /img/posts/2020/gorm-from-init-to-use/gorm-5-1280w.webp 1280w, /img/posts/2020/gorm-from-init-to-use/gorm-5-840w.webp 840w, /img/posts/2020/gorm-from-init-to-use/gorm-5-320w.webp 320w" type="image/webp"><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/2020/gorm-from-init-to-use/gorm-5-1920w.png 1920w, /img/posts/2020/gorm-from-init-to-use/gorm-5-1280w.png 1280w, /img/posts/2020/gorm-from-init-to-use/gorm-5-840w.png 840w, /img/posts/2020/gorm-from-init-to-use/gorm-5-320w.png 320w" type="image/png"><img alt="" height="114" src="/img/posts/2020/gorm-from-init-to-use/gorm-5-1920w.png" width="471" decoding="async" loading="lazy" style="background-size:cover;background-image:url(&#34;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 471 114'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23b)' preserveAspectRatio='none' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAECAIAAAAI1ii7AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAh0lEQVQImVXHyQ7CIBRAUf7/F10gaWNlKC1vhALRRRMT7+pc4/xh3xlZYgi11pyz9/4HAPj8Zx7PdfU7shLSa9tUFQGWZXHOqSozjzFExFqbUmrtMggFyinCc849pRt532OMBUo5z9H7mDOEQIS9D4PciBtyBVKWi7jdYL1IGklDqkD13qPwF3QWtjLWDF17AAAAAElFTkSuQmCC'%3E%3C/image%3E%3C/svg%3E&#34;)"></picture></p><p>當然，現在什麼都還沒有。</p><p>因為 web based 的設計，pgAdmin4 跟瀏覽器綁在一起，雖然適合分散式應用，但響應速度較慢、操作較麻煩，對開發初期或個人專案來講不是很方便。有些人會選擇 pgAdmin3 或是 dbeaver 這類 GUI，這邊就見仁見智，建議先都試試看，再選擇符合自己習慣的來使用。</p><h2 id="connect-to-database"><a href="#connect-to-database" class="direct-link">#</a> Connect to Database</h2><p>建置完資料庫後，開始來開發應用程式，建立 cmd 並在 configs 跟 pkg 下加入需要的檔案</p><pre><code>project
├── cmd
│   └── postgres
│       └── main.go
├── configs
│   └── postgres
│       └── config.json
├── data
│   └── postgres
├── pkg
│   └── postgres
│       ├── client.go
│       └── config.go
├── scripts
│   └── postgres
│       └── initialize.sql
├── go.mod
└── README.md
</code></pre><p>pkg/client 用來建立資料庫的客戶端；pkg/config 用來設定資料庫。</p><p>引入 gorm</p><pre class="language-bash"><code class="language-bash">go get -u github.com/jinzhu/gorm</code></pre><p>configs/config.json 的內容是</p><pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>    <span class="token property">"Addr"</span><span class="token operator">:</span> <span class="token string">"127.0.0.1"</span><span class="token punctuation">,</span><br>    <span class="token property">"Port"</span><span class="token operator">:</span> <span class="token number">5432</span><span class="token punctuation">,</span><br>    <span class="token property">"Username"</span><span class="token operator">:</span> <span class="token string">"postgres"</span><span class="token punctuation">,</span><br>    <span class="token property">"Name"</span><span class="token operator">:</span> <span class="token string">"postgres"</span><span class="token punctuation">,</span><br>    <span class="token property">"Password"</span><span class="token operator">:</span> <span class="token string">"postgres"</span><br><span class="token punctuation">}</span></code></pre><p>表明連線的位置、端口、使用者帳密等。這些資訊可以用 Golang 在 pkg/config 讀出，內容是</p><pre class="language-go"><code class="language-go"><span class="token keyword">package</span> postgres<br><br><span class="token keyword">import</span> <span class="token punctuation">(</span><br>    <span class="token string">"encoding/json"</span><br>    <span class="token string">"io/ioutil"</span><br><span class="token punctuation">)</span><br><br><span class="token keyword">type</span> dbConfig <span class="token keyword">struct</span> <span class="token punctuation">{</span><br>    Addr     <span class="token builtin">string</span><br>    Port     <span class="token builtin">int</span><br>    Username <span class="token builtin">string</span><br>    Name     <span class="token builtin">string</span><br>    Password <span class="token builtin">string</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">func</span> <span class="token function">getDbConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span>dbConfig <span class="token punctuation">{</span><br>    config <span class="token operator">:=</span> dbConfig<span class="token punctuation">{</span><span class="token punctuation">}</span><br>    file <span class="token operator">:=</span> <span class="token string">"./configs/postgres/config.json"</span><br>    data<span class="token punctuation">,</span> err <span class="token operator">:=</span> ioutil<span class="token punctuation">.</span><span class="token function">ReadFile</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><br>    err <span class="token operator">=</span> json<span class="token punctuation">.</span><span class="token function">Unmarshal</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token operator">&</span>config<span class="token punctuation">)</span><br>    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><br>        <span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br>    <span class="token keyword">return</span> <span class="token operator">&</span>config<br><span class="token punctuation">}</span></code></pre><p>有設定檔的資料後，Golang 可以在 pkg/client 根據設定來建立連線，內容是</p><pre class="language-go"><code class="language-go"><span class="token keyword">package</span> postgres<br><br><span class="token keyword">import</span> <span class="token punctuation">(</span><br>    <span class="token string">"github.com/jinzhu/gorm"</span><br>    <span class="token comment">// for postgres</span><br>    <span class="token boolean">_</span> <span class="token string">"github.com/jinzhu/gorm/dialects/postgres"</span><br>    <span class="token string">"fmt"</span><br><span class="token punctuation">)</span><br><br><span class="token keyword">type</span> DBClient <span class="token keyword">struct</span> <span class="token punctuation">{</span><br>    client <span class="token operator">*</span>gorm<span class="token punctuation">.</span>DB<br><span class="token punctuation">}</span><br><br><span class="token keyword">func</span> <span class="token punctuation">(</span>m <span class="token operator">*</span>DBClient<span class="token punctuation">)</span> <span class="token function">Connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    config <span class="token operator">:=</span> <span class="token function">getDbConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    client<span class="token punctuation">,</span> err <span class="token operator">:=</span> gorm<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><br>        <span class="token string">"postgres"</span><span class="token punctuation">,</span><br>        fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><br>            <span class="token string">"host=%s port=%d user=%s dbname=%s password=%s sslmode=disable"</span><span class="token punctuation">,</span><br>            config<span class="token punctuation">.</span>Addr<span class="token punctuation">,</span><br>            config<span class="token punctuation">.</span>Port<span class="token punctuation">,</span><br>            config<span class="token punctuation">.</span>Username<span class="token punctuation">,</span><br>            config<span class="token punctuation">.</span>Name<span class="token punctuation">,</span><br>            config<span class="token punctuation">.</span>Password<span class="token punctuation">,</span><br>        <span class="token punctuation">)</span><span class="token punctuation">,</span><br>    <span class="token punctuation">)</span><br>    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><br>        <span class="token function">panic</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br>    m<span class="token punctuation">.</span>client <span class="token operator">=</span> client<br><span class="token punctuation">}</span><br><br><span class="token keyword">func</span> <span class="token punctuation">(</span>m <span class="token operator">*</span>DBClient<span class="token punctuation">)</span> <span class="token function">Disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    m<span class="token punctuation">.</span>client<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span></code></pre><p>主要的程式碼是</p><pre class="language-go"><code class="language-go">client<span class="token punctuation">,</span> err <span class="token operator">:=</span> gorm<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><br>    <span class="token string">"postgres"</span><span class="token punctuation">,</span><br>    fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><br>        <span class="token string">"host=%s port=%d user=%s dbname=%s password=%s sslmode=disable"</span><span class="token punctuation">,</span><br>        config<span class="token punctuation">.</span>Addr<span class="token punctuation">,</span><br>        config<span class="token punctuation">.</span>Port<span class="token punctuation">,</span><br>        config<span class="token punctuation">.</span>Username<span class="token punctuation">,</span><br>        config<span class="token punctuation">.</span>Name<span class="token punctuation">,</span><br>        config<span class="token punctuation">.</span>Password<span class="token punctuation">,</span><br>    <span class="token punctuation">)</span><span class="token punctuation">,</span><br><span class="token punctuation">)</span></code></pre><p>gorm 的設定很單純，只要指定連線的資料庫類型；再輸入對應的參數，就能進行連線。連線後會回傳 client 供後續操作。這邊將 client 保存到 m.client 中。</p><p>如果要中斷連線，則可以用</p><pre class="language-go"><code class="language-go">m<span class="token punctuation">.</span>client<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>有了 client 後，就能在 cmd/main.go 中使用它</p><pre class="language-go"><code class="language-go"><span class="token keyword">package</span> main<br><br><span class="token keyword">import</span> <span class="token punctuation">(</span><br>    <span class="token string">"example/pkg/postgres"</span><br>    <span class="token string">"fmt"</span><br><span class="token punctuation">)</span><br><br><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    client <span class="token operator">:=</span> postgres<span class="token punctuation">.</span>DBClient<span class="token punctuation">{</span><span class="token punctuation">}</span><br>    client<span class="token punctuation">.</span><span class="token function">Connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    client<span class="token punctuation">.</span><span class="token function">Disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span></code></pre><h2 id="crud"><a href="#crud" class="direct-link">#</a> CRUD</h2><p>CRUD 是資料庫的四種操作，分別是 Create/Read/Update/Delete。前面已經連上資料庫了，接著把 CRUD 給補齊</p><p>先來建模，新增 pkg/player.go</p><pre><code>project
├── cmd
│   └── postgres
│       └── main.go
├── configs
│   └── postgres
│       └── config.json
├── data
│   └── postgres
├── pkg
│   └── postgres
│       ├── client.go
│       ├── player.go
│       └── config.go
├── scripts
│   └── postgres
│       └── initialize.sql
├── go.mod
└── README.md
</code></pre><p>內容跟前面建好的 schema 相同</p><pre class="language-go"><code class="language-go"><span class="token keyword">package</span> postgres<br><br><span class="token comment">// Player is player</span><br><span class="token keyword">type</span> Player <span class="token keyword">struct</span> <span class="token punctuation">{</span><br>    ID <span class="token builtin">int</span><br>    Age <span class="token builtin">int</span><br>    Username <span class="token builtin">string</span><br>    Budget <span class="token builtin">int</span><br><span class="token punctuation">}</span></code></pre><p>修改 client 的操作，加入 Create</p><pre class="language-go"><code class="language-go"><span class="token keyword">func</span> <span class="token punctuation">(</span>m <span class="token operator">*</span>DBClient<span class="token punctuation">)</span> <span class="token function">Insert</span><span class="token punctuation">(</span>player Player<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span><br>    res <span class="token operator">:=</span> m<span class="token punctuation">.</span>client<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span><span class="token operator">&</span>player<span class="token punctuation">)</span><br>    <span class="token keyword">if</span> res<span class="token punctuation">.</span>Error <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><br>        <span class="token keyword">return</span> res<span class="token punctuation">.</span>Error<br>    <span class="token punctuation">}</span><br>    <span class="token keyword">return</span> <span class="token boolean">nil</span><br><span class="token punctuation">}</span></code></pre><p>簽名很直觀，應用端會傳入資料，client 將資料傳給資料庫，如果有錯誤就回報。</p><p>加入 Read</p><pre class="language-go"><code class="language-go"><span class="token keyword">func</span> <span class="token punctuation">(</span>m <span class="token operator">*</span>DBClient<span class="token punctuation">)</span> <span class="token function">Get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span>Player<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    players <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>Player<span class="token punctuation">{</span><span class="token punctuation">}</span><br>    res <span class="token operator">:=</span> m<span class="token punctuation">.</span>client<span class="token punctuation">.</span><span class="token function">Order</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span><span class="token operator">&</span>players<span class="token punctuation">)</span><br>    <span class="token keyword">if</span> res<span class="token punctuation">.</span>Error <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><br>        <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> res<span class="token punctuation">.</span>Error<br>    <span class="token punctuation">}</span><br>    <span class="token keyword">return</span> players<span class="token punctuation">,</span> <span class="token boolean">nil</span><br><span class="token punctuation">}</span></code></pre><p>這個稍微複雜點，client 用 Find 查詢資料，並將得到的資料 assign 給 struct，由於資料可能有多筆，要使用 slice。前面的 Order 是排序用，確保得到的資料會依照 id 來排。得到資料後，將資料回傳給應用端。</p><p>加入 Update</p><pre class="language-go"><code class="language-go"><span class="token keyword">func</span> <span class="token punctuation">(</span>m <span class="token operator">*</span>DBClient<span class="token punctuation">)</span> <span class="token function">Update</span><span class="token punctuation">(</span>player Player<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span><br>    res <span class="token operator">:=</span> m<span class="token punctuation">.</span>client<span class="token punctuation">.</span><span class="token function">Save</span><span class="token punctuation">(</span><span class="token operator">&</span>player<span class="token punctuation">)</span><br>    <span class="token keyword">if</span> res<span class="token punctuation">.</span>Error <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><br>        <span class="token keyword">return</span> res<span class="token punctuation">.</span>Error<br>    <span class="token punctuation">}</span><br>    <span class="token keyword">return</span> <span class="token boolean">nil</span><br><span class="token punctuation">}</span></code></pre><p>這邊改用 Save 來保存資料；gorm 的 Save 是當資料不存在時，會創建資料，資料存在時，會更新資料。用來判斷存不存在的依據是 id，應用端傳下來的值應該要帶 id，才能有更新的效果。</p><p>加入 Delete</p><pre class="language-go"><code class="language-go"><span class="token keyword">func</span> <span class="token punctuation">(</span>m <span class="token operator">*</span>DBClient<span class="token punctuation">)</span> <span class="token function">Delete</span><span class="token punctuation">(</span>player Player<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span><br>    res <span class="token operator">:=</span> m<span class="token punctuation">.</span>client<span class="token punctuation">.</span><span class="token function">Delete</span><span class="token punctuation">(</span><span class="token operator">&</span>player<span class="token punctuation">)</span><br>    <span class="token keyword">if</span> res<span class="token punctuation">.</span>Error <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><br>        <span class="token keyword">return</span> res<span class="token punctuation">.</span>Error<br>    <span class="token punctuation">}</span><br>    <span class="token keyword">return</span> <span class="token boolean">nil</span><br><span class="token punctuation">}</span></code></pre><p>很直觀，就是刪除，值得注意的是 gorm 有特別說明</p><blockquote><p>Delete delete value match given conditions, if the value has primary key, then will including the primary key as condition<br>WARNING If model has DeletedAt field, GORM will only set field DeletedAt’s value to current time</p></blockquote><p>記得要帶主 key，以免找不到條件而刪除整張表格；有時在資料庫應用中，因為有稽核與回滾的需求，不希望刪除資料，取而代之是使用標記的方式來表示該資料已經不被使用了。如果要標記刪除，可以用 DeletedAt 這個欄位。</p><p>建好 CRUD 後，在應用端也加入對應的使用</p><pre class="language-go"><code class="language-go"><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    client <span class="token operator">:=</span> postgres<span class="token punctuation">.</span>DBClient<span class="token punctuation">{</span><span class="token punctuation">}</span><br>    client<span class="token punctuation">.</span><span class="token function">Connect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    player <span class="token operator">:=</span> postgres<span class="token punctuation">.</span>Player<span class="token punctuation">{</span><br>        Age<span class="token punctuation">:</span>      <span class="token number">18</span><span class="token punctuation">,</span><br>        Username<span class="token punctuation">:</span> <span class="token string">"ken"</span><span class="token punctuation">,</span><br>        Budget<span class="token punctuation">:</span>   <span class="token number">1000</span><span class="token punctuation">,</span><br>    <span class="token punctuation">}</span><br>    client<span class="token punctuation">.</span><span class="token function">Insert</span><span class="token punctuation">(</span>player<span class="token punctuation">)</span><br>    players<span class="token punctuation">,</span> err <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><br>        fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br>    <span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>players<span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">1</span> <span class="token punctuation">{</span><br>        players<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Budget <span class="token operator">=</span> <span class="token number">2000</span><br>        client<span class="token punctuation">.</span><span class="token function">Update</span><span class="token punctuation">(</span>players<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br>    client<span class="token punctuation">.</span><span class="token function">Disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span></code></pre><p>編譯並執行程式碼，可以在 pgAdmin 上看到結果</p><p><picture><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/2020/gorm-from-init-to-use/gorm-6-1920w.webp 1920w, /img/posts/2020/gorm-from-init-to-use/gorm-6-1280w.webp 1280w, /img/posts/2020/gorm-from-init-to-use/gorm-6-840w.webp 840w, /img/posts/2020/gorm-from-init-to-use/gorm-6-320w.webp 320w" type="image/webp"><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/2020/gorm-from-init-to-use/gorm-6-1920w.png 1920w, /img/posts/2020/gorm-from-init-to-use/gorm-6-1280w.png 1280w, /img/posts/2020/gorm-from-init-to-use/gorm-6-840w.png 840w, /img/posts/2020/gorm-from-init-to-use/gorm-6-320w.png 320w" type="image/png"><img alt="" height="91" src="/img/posts/2020/gorm-from-init-to-use/gorm-6-1920w.png" width="473" decoding="async" loading="lazy" style="background-size:cover;background-image:url(&#34;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 473 91'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23b)' preserveAspectRatio='none' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAADCAIAAAARJsg+AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAd0lEQVQImSWL2wrDIBAF/f9/tAGFJkG0gu6tu2tLknk6zHCCmpVSaq0AICLvfT+PQ1VbazHGlNIYo/euqkT02racMyIGJALECTAB1IyYAVG+8um9tsbMV5pTzXwtJBpz1tqC+zL3342ZP9vdWUTVHn+bdR8viPgPgrSbh+QCdqkAAAAASUVORK5CYII='%3E%3C/image%3E%3C/svg%3E&#34;)"></picture></p><p>執行多次，可以看到每次執行都會增加一筆，同時 id = 2 的資料 budget 被改成 2000</p><p><picture><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/2020/gorm-from-init-to-use/gorm-7-1920w.webp 1920w, /img/posts/2020/gorm-from-init-to-use/gorm-7-1280w.webp 1280w, /img/posts/2020/gorm-from-init-to-use/gorm-7-840w.webp 840w, /img/posts/2020/gorm-from-init-to-use/gorm-7-320w.webp 320w" type="image/webp"><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/2020/gorm-from-init-to-use/gorm-7-1920w.png 1920w, /img/posts/2020/gorm-from-init-to-use/gorm-7-1280w.png 1280w, /img/posts/2020/gorm-from-init-to-use/gorm-7-840w.png 840w, /img/posts/2020/gorm-from-init-to-use/gorm-7-320w.png 320w" type="image/png"><img alt="" height="200" src="/img/posts/2020/gorm-from-init-to-use/gorm-7-1920w.png" width="473" decoding="async" loading="lazy" style="background-size:cover;background-image:url(&#34;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 473 200'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23b)' preserveAspectRatio='none' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAFCAIAAAD+GJp4AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAiElEQVQImRXIWwrDMAwFUe9/k4WmKYUmUWS7jnX1KoH5OEx5fo7Heyfu53nW2oho23YiEoGZt9YBLb/++363OSdzba3VWpdlYeYxBqDraz2Ziwg8UtXUzD2YK4CIMHf3iIiDqExBZpo5cIOZr3llZkR6pLsfB5U5ATWBiijUxrim3OcOBmjv1x8UuK1Eqpb6aQAAAABJRU5ErkJggg=='%3E%3C/image%3E%3C/svg%3E&#34;)"></picture></p><h2 id="join"><a href="#join" class="direct-link">#</a> Join</h2><p>有時候會需要同時取得兩張表格的資料，並合成一張大表格，在資料庫的操作中稱為 Join。來看一個情境，假設現在新增一張 games 的表格，用來表示比賽的地點、勝利選手、獎金。可以修改 sql 為</p><pre class="language-sql"><code class="language-sql"><span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> players<span class="token punctuation">;</span><br><span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> games<span class="token punctuation">;</span><br><br><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> players <span class="token punctuation">(</span><br>    id <span class="token keyword">SERIAL</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span><br>    age <span class="token keyword">SMALLINT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span><br>    username <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span><br>    budget <span class="token keyword">INTEGER</span><br><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> games <span class="token punctuation">(</span><br>    id <span class="token keyword">SERIAL</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span><br>    winner_id <span class="token keyword">SMALLINT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span><br>    location <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span><br>    prize <span class="token keyword">INTEGER</span><br><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>並在 pkg 下建立新模型 game.go</p><pre><code>project
├── cmd
│   └── postgres
│       └── main.go
├── configs
│   └── postgres
│       └── config.json
├── data
│   └── postgres
├── pkg
│   └── postgres
│       ├── client.go
│       ├── player.go
│       ├── game.go
│       └── config.go
├── scripts
│   └── postgres
│       └── initialize.sql
├── go.mod
└── README.md
</code></pre><p>內容是</p><pre class="language-go"><code class="language-go"><span class="token keyword">package</span> postgres<br><br><span class="token comment">// Game is game</span><br><span class="token keyword">type</span> Game <span class="token keyword">struct</span> <span class="token punctuation">{</span><br>    ID       <span class="token builtin">int</span><br>    WinnerID <span class="token builtin">int</span><br>    Location <span class="token builtin">string</span><br>    Prize    <span class="token builtin">int</span><br><span class="token punctuation">}</span></code></pre><p>現在有個需求，希望查詢選手時，能一併查詢出該選手贏得的比賽，這時就可以透過 Join 來完成。</p><p>在原本的 game.go 中新增一個擴增表格用的結構</p><pre class="language-go"><code class="language-go"><span class="token comment">// JoinResult is join result</span><br><span class="token keyword">type</span> JoinResult <span class="token keyword">struct</span> <span class="token punctuation">{</span><br>    Player<br>    Game<br><span class="token punctuation">}</span></code></pre><p>因為 Golang 組合的特性，直接用兩個子結構合併即可。</p><p>在 client 的使用中新增 Join</p><pre class="language-go"><code class="language-go"><span class="token keyword">func</span> <span class="token punctuation">(</span>m <span class="token operator">*</span>DBClient<span class="token punctuation">)</span> <span class="token function">GetPlayerJoinGame</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span>JoinResult<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    results <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>JoinResult<span class="token punctuation">{</span><span class="token punctuation">}</span><br>    res <span class="token operator">:=</span> m<span class="token punctuation">.</span>client<span class="token punctuation">.</span><span class="token function">Table</span><span class="token punctuation">(</span><span class="token string">"players"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span><span class="token string">"*"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Joins</span><span class="token punctuation">(</span><span class="token string">"inner join games on players.id = games.winner_id"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Scan</span><span class="token punctuation">(</span><span class="token operator">&</span>results<span class="token punctuation">)</span><br>    <span class="token keyword">if</span> res<span class="token punctuation">.</span>Error <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span><br>        <span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> res<span class="token punctuation">.</span>Error<br>    <span class="token punctuation">}</span><br>    <span class="token keyword">return</span> results<span class="token punctuation">,</span> <span class="token boolean">nil</span><br><span class="token punctuation">}</span></code></pre><p>Join 的條件是 player 的 id 等於 game 的 winner_id，就將兩者表示為同一列。得到的結果用 Scan 裝進 results 結構中。</p><p>用 pgAdmin 手動新增一筆 game 的資料</p><p><picture><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/2020/gorm-from-init-to-use/gorm-8-1920w.webp 1920w, /img/posts/2020/gorm-from-init-to-use/gorm-8-1280w.webp 1280w, /img/posts/2020/gorm-from-init-to-use/gorm-8-840w.webp 840w, /img/posts/2020/gorm-from-init-to-use/gorm-8-320w.webp 320w" type="image/webp"><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/2020/gorm-from-init-to-use/gorm-8-1920w.png 1920w, /img/posts/2020/gorm-from-init-to-use/gorm-8-1280w.png 1280w, /img/posts/2020/gorm-from-init-to-use/gorm-8-840w.png 840w, /img/posts/2020/gorm-from-init-to-use/gorm-8-320w.png 320w" type="image/png"><img alt="" height="92" src="/img/posts/2020/gorm-from-init-to-use/gorm-8-1920w.png" width="480" decoding="async" loading="lazy" style="background-size:cover;background-image:url(&#34;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 480 92'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23b)' preserveAspectRatio='none' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAADCAIAAAARJsg+AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAkklEQVQImR3KKRLCQBBA0ZwMx1mQGK6BRnAFJDdAIDFxU6moSWWhsgw9PRN6o8JTX/wi5dx23ThNKSVMyTeNcw4AQghVVXV9HxHnZWGi9zgfzrfd8bI/XYu4wRACIjJzRAQAVQWI3vthGADgA8DMX+Kybp9lfX+8CmIWVTNTs61FzExE8rqmnInI/kSVmbfPTIV+PvCV58s0bzIAAAAASUVORK5CYII='%3E%3C/image%3E%3C/svg%3E&#34;)"></picture></p><p>在應用端加入查詢，並印出</p><pre class="language-go"><code class="language-go">results<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">GetPlayerJoinGame</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>results<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><br>client<span class="token punctuation">.</span><span class="token function">Disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><p>編譯並執行，得到</p><pre class="language-go"><code class="language-go"><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token number">2</span> <span class="token number">18</span> ken <span class="token number">2000</span><span class="token punctuation">}</span> <span class="token punctuation">{</span><span class="token number">1</span> <span class="token number">2</span> New York <span class="token number">3000</span><span class="token punctuation">}</span><span class="token punctuation">}</span></code></pre><p>前一個 {} 是選手的資料；後一個 {} 是比賽的資料。透過單次查詢，得到兩個表格的資料並放入同一個結構中。</p><h2 id="%E5%B0%8F%E7%B5%90"><a href="#%E5%B0%8F%E7%B5%90" class="direct-link">#</a> 小結</h2><p>跑完 CRUD 後，覺得 gorm 的用法比想像中直覺，反而是前面建置資料庫的步驟比較麻煩。Golang 以組合來替代繼承的哲學，的確讓它在操作資料庫上顯得更輕巧。但錯誤處理的方式還是有些繁瑣，某程度上，會有種 Golang 希望開發者對於第三方套件保持警戒的味道在。</p><p>很有意思的是，如果使用 Wireshark 來看，gorm 的查詢會是</p><p><picture><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/2020/gorm-from-init-to-use/gorm-9-1920w.webp 1920w, /img/posts/2020/gorm-from-init-to-use/gorm-9-1280w.webp 1280w, /img/posts/2020/gorm-from-init-to-use/gorm-9-840w.webp 840w, /img/posts/2020/gorm-from-init-to-use/gorm-9-320w.webp 320w" type="image/webp"><source sizes="(max-width: 758px) 100vw, 758px" srcset="/img/posts/2020/gorm-from-init-to-use/gorm-9-1920w.png 1920w, /img/posts/2020/gorm-from-init-to-use/gorm-9-1280w.png 1280w, /img/posts/2020/gorm-from-init-to-use/gorm-9-840w.png 840w, /img/posts/2020/gorm-from-init-to-use/gorm-9-320w.png 320w" type="image/png"><img alt="" height="163" src="/img/posts/2020/gorm-from-init-to-use/gorm-9-1920w.png" width="921" decoding="async" loading="lazy" style="background-size:cover;background-image:url(&#34;data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http%3A//www.w3.org/2000/svg' xmlns%3Axlink='http%3A//www.w3.org/1999/xlink' viewBox='0 0 921 163'%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='.5'%3E%3C/feGaussianBlur%3E%3CfeComponentTransfer%3E%3CfeFuncA type='discrete' tableValues='1 1'%3E%3C/feFuncA%3E%3C/feComponentTransfer%3E%3C/filter%3E%3Cimage filter='url(%23b)' preserveAspectRatio='none' height='100%25' width='100%25' xlink%3Ahref='data%3Aimage/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAADCAIAAAARJsg+AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAd0lEQVQImU3Kyw4CIQxAUf7/75w4m1GgnUwLsYA8LGuTMRrP4q6uuVu7XJbttnkAAPTenby1DgCJiJmJiA46DgohxBhFxOw7rusVEZlZRErOKYk8RERSzs8/vfc5p57MGMM5xyGknGqtrfVSSmtNdf4mVX19+vUGzFKUEB4570wAAAAASUVORK5CYII='%3E%3C/image%3E%3C/svg%3E&#34;)"></picture></p><p>如果熟悉 Postgres 的通訊協定的話，也許可以成為效能優化的參考。</p><h2 id="reference"><a href="#reference" class="direct-link">#</a> Reference</h2><ul><li><a href="https://github.com/go-gorm/gorm" rel="noopener noreferrer" target="_blank">Gorm GitHub</a></li><li><a href="https://medium.com/@shengyou/-2018ironman-eos-for-php-developer-day28-19521bffeb7d" rel="noopener noreferrer" target="_blank">[2018 鐵人賽] 簡潔高效的 PHP & Laravel 工作術：從 elementary OS 下手的聰明改造提案 #28</a></li><li><a href="https://docs.postgresql.tw/" rel="noopener noreferrer" target="_blank">Postgres 正體中文使用手冊</a></li></ul><div class="article-footer"></div><div><p style="font-weight: bold;">標籤</p><div class="post-tags"><a href="/tags/go/" class="post-tag">Go</a> <a href="/tags/database/" class="post-tag">Database</a></div><p style="font-weight: bold;">其他文章</p><ul><li><a href="/posts/2022/oauth-2-0-roles-and-channels/">OAuth 2.0：角色與信道</a></li><li><a href="/posts/2022/go-error-handling/">如何優雅包裝錯誤：聊聊 Go 的 error</a></li><li><a href="/posts/2022/error-as-resource-grpc-error-handling/">讓錯誤成為資源：gRPC 的錯誤處理模型</a></li><li><a href="/posts/2019/coding-by-your-smartphone/">全世界都是你的工作室：GCP 的雲端開發環境</a></li><li><a href="/posts/2019/using-physical-disc-with-virtualbox/">用 VirtualBox 開啟實體硬碟中的 Windows</a></li></ul></div><p style="font-weight: bold;">評論</p><script async="" src="https://utteranc.es/client.js" crossorigin="anonymous" id="utterance-script" issue-term="title" label="utterance" repo="ken00535/blog" theme="github-light"></script><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"GORM：從建置到 CRUD","image":["https://blog.kenwsc.com/img/posts/2020/gorm-from-init-to-use/gorm-1-1920w.png","https://blog.kenwsc.com/img/posts/2020/gorm-from-init-to-use/gorm-2-1920w.png","https://blog.kenwsc.com/img/posts/2020/gorm-from-init-to-use/gorm-3-1920w.png","https://blog.kenwsc.com/img/posts/2020/gorm-from-init-to-use/gorm-4-1920w.png","https://blog.kenwsc.com/img/posts/2020/gorm-from-init-to-use/gorm-5-1920w.png","https://blog.kenwsc.com/img/posts/2020/gorm-from-init-to-use/gorm-6-1920w.png","https://blog.kenwsc.com/img/posts/2020/gorm-from-init-to-use/gorm-7-1920w.png","https://blog.kenwsc.com/img/posts/2020/gorm-from-init-to-use/gorm-8-1920w.png","https://blog.kenwsc.com/img/posts/2020/gorm-from-init-to-use/gorm-9-1920w.png"],"author":{"@type":"Person","name":""},"publisher":{"@type":"Organization","name":"Ken Chen&#39;s Blog","url":"https://blog.kenwsc.com","logo":{"@type":"ImageObject","url":"https://blog.kenwsc.com/img/favicon/favicon.png","width":512,"height":512}},"url":"https://blog.kenwsc.com/posts/2020/gorm-from-init-to-use/","mainEntityOfPage":"https://blog.kenwsc.com/posts/2020/gorm-from-init-to-use/","datePublished":"2020-07-26","dateModified":"2022-12-20","description":"進行後端開發時，少不了要使用資料庫，由於資料庫的設計與使用方式偏向函數思維，跟主流的物件導向習慣不同，因此很多語言都有對應的 ORM 套件，用來將資料庫轉為物件，方便開發者使用。 Golang 同樣有許多第三方的 ORM 套件，例如..."}</script></article></main><footer><div class="footer-logos"><a href="https://medium.com/@ken00535" rel="noopener noreferrer" target="_blank"><img alt="medium" height="50" src="/img/icons/icon_social media_medium.svg" width="50"></a><a href="https://www.linkedin.com/in/ken00535" rel="noopener noreferrer" target="_blank"><img alt="linkedin" height="30" src="/img/icons/icon_social media_linkedln.svg" width="30"></a><a href="https://blog.kenwsc.com/feed/feed.xml" rel="noreferrer noopener" target="_blank"><img alt="rss feed" height="30" src="/img/icons/rss-feed.svg" width="30"></a></div><div class="copyright">© 2022 Ken Chen's Blog, Powered by <a href="https://github.com/google/eleventy-high-performance-blog" rel="noopener noreferrer" target="_blank">eleventy-high-performance-blog</a></div></footer><script>// light/dark theme switch
      // disable dark mode for now
      const menuBtn = document.querySelector('.menu__btn')
      menuBtn.addEventListener('click', function() {
        document.querySelector('body').classList.toggle('lock')
        menuBtn.classList.toggle('menu__btn--close');
        document.querySelector('.nav__links').classList.toggle('nav__links--open')
      })</script></body></html>