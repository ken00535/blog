<!DOCTYPE html><html domain="blog.kenwsc.com" ga-id="G-G76M9XJCKN" lang="zh-TW"><head><meta charset="utf-8"><meta content="width=device-width,initial-scale=1" name="viewport"><meta content="Backend,Golang" name="keywords"><link href="/img/favicon/favicon.png?hash=b6fc65e341" rel="icon" type="image/png"><meta content="#5789d3" name="theme-color"><title>Go 的泛型替代方案：型別斷言與代碼生成</title><meta content="Go 的泛型替代方案：型別斷言與代碼生成" property="og:title"><meta content="Go 的泛型替代方案：型別斷言與代碼生成" name="twitter:title"><meta content="summary_large_image" name="twitter:card"><meta content="在 The Next Step for Generics 這篇文章中，Golang 有公開泛型的草稿，但至少到 1.15 為止，實務上仍需要仰賴別的方式來達到接近的效果。本篇會分別用型別斷言(type assertion)跟 genny 這套 Golang 開源函式庫，來試著實現一些基本函式，看看 Golang 如何處理泛型問題..." name="description"><meta content="在 The Next Step for Generics 這篇文章中，Golang 有公開泛型的草稿，但至少到 1.15 為止，實務上仍需要仰賴別的方式來達到接近的效果。本篇會分別用型別斷言(type assertion)跟 genny 這套 Golang 開源函式庫，來試著實現一些基本函式，看看 Golang 如何處理泛型問題..." name="twitter:description"><meta content="在 The Next Step for Generics 這篇文章中，Golang 有公開泛型的草稿，但至少到 1.15 為止，實務上仍需要仰賴別的方式來達到接近的效果。本篇會分別用型別斷言(type assertion)跟 genny 這套 Golang 開源函式庫，來試著實現一些基本函式，看看 Golang 如何處理泛型問題..." property="og:description"><meta content="article" property="og:type"><meta content="https://blog.kenwsc.com/posts/2020/go-generic-alter-plan-assert-and-codegen/" property="og:url"><meta content="Ken Chen's Blog" property="og:site_name"><meta content="https://blog.kenwsc.com/img/posts/2020/go-generic-alter-plan-assert-and-codegen/cover.png" property="og:image"><meta content="https://blog.kenwsc.com/img/posts/2020/go-generic-alter-plan-assert-and-codegen/cover.png" name="twitter:image"><meta content="hsZQwAip9iIbys-i4PJp_MfpNiA6w6RB0hYdWLiLUuk" name="google-site-verification"><link href="https://blog.kenwsc.com/posts/2020/go-generic-alter-plan-assert-and-codegen/" rel="canonical"><meta content="always" name="referrer"><link href="/feed/feed.xml" rel="alternate" type="application/atom+xml" title="Ken Chen's Blog"><link href="/" rel="preconnect" crossorigin=""><script async="" src="/js/min.js?hash=7f26b2ece8" defer=""></script><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-G76M9XJCKN"></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-G76M9XJCKN');</script><script csp-hash="">if (/Mac OS X/.test(navigator.userAgent))document.documentElement.classList.add('apple')</script><style>:root{--primary-color: #5789d3;--primary-dark-color: #ffd349;--fgColor: #2f2f2f;--bgColor: linear-gradient(to top, #efefef, #ffffff);--primary: var(--primary-color);--primary-dark: var(--primary-dark-color);--fg: var(--fgColor);--bg: var(--bgColor);--progressColor: #ffd349;--main-width: calc(100vw - 3em)}main img{content-visibility:auto}article *{scroll-margin-top:50px}header nav{z-index:1;position:fixed;top:0;left:0;width:100vw;background:#fff;font-weight:200;text-align:right;padding:0}@media (min-width:37.5em){:root{--main-width: calc(37.5em - 3em)}}dialog,share-widget{position:fixed;opacity:.9}share-widget{right:20px;bottom:20px;width:50px;height:50px;border-radius:50%;overflow:hidden;box-shadow:2px 3px 5px 2px rgba(0,0,0,.2)}@media screen and (max-width:376px){share-widget{display:none}}share-widget div{margin-left:50%;transform:translateX(-50%);width:20px;height:20px;background-image:url(/img/share.svg);background-repeat:no-repeat;background-position:center;background-size:contain}.apple share-widget div{background-image:url(/img/share-apple.svg)}share-widget button{margin:0;padding:0;width:100%;height:100%;transition:.3s}share-widget button:active{transform:scale(1.2)}dialog{background-color:var(--primary-dark);z-index:1000;font-size:14px}#reading-progress{z-index:1;background-color:var(--progressColor);width:100vw;position:absolute;left:0;bottom:0;height:2px;transform:translate(-100vw,0);will-change:transform;pointer-events:none}#posts li{margin-bottom:.5em}button,html{line-height:1.15}html{-webkit-text-size-adjust:100%;font-family:"Open Sans",-apple-system,system-ui,BlinkMacSystemFont,"Segoe UI",Roboto,"Noto Sans","Helvetica Neue",Helvetica,Arial,"Noto Sans TC","PingFang TC","Hiragino Sans GB","Heiti TC","Microsoft YaHei","Microsoft Jhenghei",sans-serif;--font-family: "Open Sans", -apple-system, system-ui, BlinkMacSystemFont,
    "Segoe UI", Roboto, "Noto Sans", "Helvetica Neue", Helvetica, Arial,
    "Noto Sans TC", "PingFang TC", "Hiragino Sans GB", "Heiti TC",
    "Microsoft YaHei", "Microsoft Jhenghei", sans-serif}.article-footer img,body{margin:0}body.lock{overflow:hidden}a{background-color:transparent;text-underline-offset:2px;text-decoration:none;color:var(--primary)}img{border-style:none;max-width:100%;height:auto;margin:0 auto}button{font-family:inherit;font-size:100%;overflow:visible;text-transform:none}[type=button],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}template{display:none}h2{font-size:2.5em;line-height:1.2;margin-bottom:.6em;line-height:2.4rem;margin-bottom:1.36rem;font-size:1.728rem}body,p,pre,ul{font-size:1em}p,pre,ul{margin-bottom:1.5em}body,p,pre,ul{font-size:1rem;line-height:1.6}p,pre,ul{margin-bottom:1.36rem}@media (min-width:600px){h2{font-size:2.0097rem;line-height:2.52rem}body,p,pre,ul{font-size:1.1rem;line-height:1.6}h2,p,pre,ul{margin-bottom:1.496rem}}@media (min-width:1200px){h2{font-size:1.75rem}body,p,pre,ul{font-size:1.2rem;line-height:1.6}h2,p,pre,ul{margin-bottom:1.632rem}}code,pre{overflow-x:auto}pre{font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace}pre code:not([class]){overflow-x:scroll}button,code{border-radius:.3em}code{color:#e33671;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:90%}h1,h2{font-family:var(--font-family)}a:hover{text-decoration:underline}button{max-width:100%;background:#f2f2f2;color:#191919;cursor:pointer;padding:.75em 1.5em;text-align:center;margin:0 .75em 1.5em 0}button+label,label+*{page-break-before:always}button,label{display:inline-block}button:hover{background:#d9d9d9;color:#000}button:not([disabled]){background:#f9c412;color:#181818;background:var(--primary)}button:not([disabled]):hover{background:#ba9005;color:#000;background:var(--primary-dark)}*{border:0;box-sizing:border-box}body{font-family:var(--font-family);background:var(--bg);color:var(--fg)}header label{display:block}article,header{max-width:100%;width:42.5em;margin:0 auto}header{padding:4.5em 24px 0;text-align:center;display:flex;align-items:center;flex-direction:column}header p,ul{margin-top:0}header nav label{color:#000;cursor:pointer;margin:0;font-style:normal;text-align:right}main{max-width:70rem;margin:0 auto;min-height:60vh}article{padding:1.5em;word-break:break-word}li ul{margin-bottom:0}blockquote{padding:0 1.5em;margin:1.5em 0 1.5em 1.5em;border-left:4px solid var(--primary)}blockquote footer{background:0 0;display:block;color:#ccc;padding:.75em 0;font-size:90%;text-align:start}code[class*=language-],pre[class*=language-]{color:#ccc;background:0 0;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#2d2d2d}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.comment{color:#999}.token.punctuation{color:#ccc}.token.boolean,.token.function,.token.number{color:#f08d49}.token.class-name,.token.property,.token.symbol{color:#f8c555}.token.builtin,.token.keyword{color:#cc99cd}.token.string,.token.variable{color:#7ec699}.token.operator,.token.url{color:#67cdcc}.token.bold{font-weight:700}.token.inserted{color:green}::-webkit-scrollbar-thumb:hover{background:var(--primary)}.w-full{width:100%}body.dark{--fg: var(--bgColor);--bg: var(--fgColor);--primary: var(--primary-dark-color)}@media (prefers-color-scheme:dark){body.dark{--fg: var(--bgColor);--bg: var(--fgColor);--primary: var(--primary-dark-color)}}h1{font-size:32px;line-height:1.25;margin:.67em 0;text-align:left}header aside{font-size:16px;color:#4b4b4b}#nav,.menu__btn{position:relative}.menu__btn{display:inline-block;width:24px;height:24px}.menu__btn span{opacity:0;width:1px;height:1px;overflow:hidden;display:block}.menu__btn::after,.menu__btn::before{content:"";position:absolute;top:51%;left:50%;height:2px;width:17px;background-color:#2d2d2d;border-radius:.1rem}.menu__btn::before{transform:translate(-50%,-50%);box-shadow:0 .3rem 0 #2d2d2d,0 -.3rem 0 #2d2d2d}.menu__btn::after{display:none;transform:translate(-50%,-50%) rotate(90deg)}.menu__btn.menu__btn--close{z-index:9;transform:rotate(45deg)}.menu__btn.menu__btn--close::before{box-shadow:none}.menu__btn.menu__btn--close::after{display:block}#nav{height:68px;z-index:2;align-items:center}.nav__links{display:none;flex-direction:column;position:fixed;z-index:3;top:0;left:0;right:0;bottom:0;padding:86px 48px 0;background-image:linear-gradient(to top,#efefef,#fff),linear-gradient(to bottom,#f9f9f9,#f9f9f9)}#nav,.nav__links--open{display:flex}.nav__links a{text-align:left;width:100%;padding:.5rem 0;transition:all .3s ease-out;font-weight:700;text-decoration:none;color:var(--fg)}.nav__links a:hover{color:var(--primary-color)}footer{margin-top:48px;font-size:14px;padding:24px;border-top:1px solid #ccc;text-align:center}.copyright{display:inline-block}footer>*{margin:.5em}.footer-logos{display:flex;align-items:center;justify-content:center}.footer-logos a:not(:first-child){margin-left:32px}.post-tags{display:flex;gap:0 16px;flex-wrap:wrap}.post-tag:not(body){text-decoration:none;background-color:#f5f5f5;-webkit-box-align:center;-ms-flex-align:center;align-items:center;border-radius:20px;color:#4a4a4a;display:-webkit-inline-box;display:-ms-inline-flexbox;display:inline-flex;font-size:.75rem;height:2em;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;line-height:1.5;padding-left:.75em;padding-right:.75em;white-space:nowrap}.post-tag:hover{text-decoration:none;background:#ccc}.direct-link{display:none}.post-avatar{display:flex;align-items:center;height:36px}.post-avatar__time{font-size:13px}.article-footer{margin-top:40px;border-bottom:1px solid #ccc;padding-bottom:52px}.article-footer a{float:right;display:flex;align-items:center;color:var(--fg);font-weight:700;margin-left:4px}@media (min-width:768px){h1{font-size:48px}header aside{font-size:20px}header nav a:first-of-type{margin-left:auto}header nav a:last-of-type{margin-right:1.5em}.menu__btn{display:none}#nav,footer{max-width:1168px}#nav{height:80px;margin:0 auto}.nav__links{display:flex;flex-direction:row;position:static;padding:0;background-image:none}.nav__links a{text-align:center;margin-left:56px}footer{display:flex;flex-direction:row-reverse;justify-content:space-between;align-items:center;margin-left:auto;margin-right:auto}}</style></head><body><header><nav><div id="nav"><div class="nav__links"><a href="/" title="Homepage">Home</a> <a href="/archive/">Archive</a> <a href="/tags/">Tags</a> <a href="/about/">About</a></div></div><div id="reading-progress" aria-hidden="true"></div></nav><h1 class="w-full">Go 的泛型替代方案：型別斷言與代碼生成</h1><aside class="w-full"><div class="post-avatar"><div class="post-avatar__time">Ken Chen | 19 Sep 2020 <a href="/tags/go/" class="post-tag">Go</a></div></div></aside><dialog id="message"></dialog></header><main><article><div id="post-page"></div><p>用函數式編程(Functional Programming)的風格寫程式時，會常常重複使用一些通用函式，舉個例子，假設有個 array，開發者需要從該 array 中篩選符合條件的元素，重新組成新的 array。合理的情況是，如果有個 filter 函式，只需要設定條件，剩下的事情都能交給語言處理。</p><p>Golang 的 append 有點這味道，類似 JavaScript 的 push，能新增 slice 中的元素，但 Golang 畢竟不是徹底的函數式語言，內建函式庫中沒有 filter、map、reduce 等等 array 常用的函式。如果想要自行實現，語言的強型別系統會要求開發者在使用前告知對象型別，這等於是對不同的型別都要實現幾乎相同的函式，可想而知不切實際。</p><p>同樣是強型別語言，C++ 或 C# 在面對這問題時，是靠著泛型(Generic)來解決；在 <a href="https://blog.golang.org/generics-next-step" rel="noopener noreferrer" target="_blank">The Next Step for Generics</a> 這篇文章中，Golang 有公開泛型的草稿，但至少到 1.15 為止，實務上仍需要仰賴別的方式來達到接近的效果。本篇會分別用型別斷言(type assertion)跟 genny 這套 Golang 開源函式庫，來試著實現一些基本函式，看看 Golang 如何處理泛型問題。</p><p>需要 Clone 程式碼的，可以到<a href="https://github.com/ken00535/golang-medium-example" rel="noopener noreferrer" target="_blank">這裡</a>。</p><h2 id="establish-a-filter-function"><a href="#establish-a-filter-function" class="direct-link">#</a> Establish a Filter Function</h2><p>專案結構如下</p><pre><code>project
├── cmd
│   └── genny
│       └── main.go
├── pkg
│   └── genny
│       └── genny.go
├── scripts
├── go.mod
├── Makefile
└── README.md
</code></pre><p>先來看 pkg 內的 genny.go</p><pre class="language-go"><code class="language-go"><span class="token keyword">package</span> genny<br><br><span class="token comment">// Filter filter slice</span><br><span class="token keyword">func</span> <span class="token function">Filter</span><span class="token punctuation">(</span>source <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">,</span> callback <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span> <span class="token punctuation">{</span><br>    <span class="token keyword">var</span> out <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><br>    <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> element <span class="token operator">:=</span> <span class="token keyword">range</span> source <span class="token punctuation">{</span><br>    <span class="token keyword">if</span> <span class="token function">callback</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    out <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>out<span class="token punctuation">,</span> element<span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br>    <span class="token keyword">return</span> out<br><span class="token punctuation">}</span></code></pre><p>我們的目標是設計 Filter 函式，該函式可用來篩選 slice。使用者傳入 slice 跟 callback function，遍歷 slice，使用 callback 看結果。如果 callback 結果是 true，代表 element 符合篩選的條件，將 element 加入新的 slice，最後將新的 slice 傳送回去。</p><p>因為 Golang 是強型別語言，在設計函式時需要宣告參數型別，在上面的設計中，型別是 int，這也代表該函式只能用於 int[]。</p><p>來看 cmd 中的使用方式</p><pre class="language-go"><code class="language-go"><span class="token keyword">package</span> main<br><br><span class="token keyword">import</span> <span class="token punctuation">(</span><br>    <span class="token string">"example/pkg/genny"</span><br>    <span class="token string">"fmt"</span><br><span class="token punctuation">)</span><br><br><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    num <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">}</span><br>    <span class="token comment">// filter by static filter</span><br>    num <span class="token operator">=</span> genny<span class="token punctuation">.</span><span class="token function">Filter</span><span class="token punctuation">(</span>num<span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>element <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{</span><br>    <span class="token keyword">if</span> element <span class="token operator">&lt;</span> <span class="token number">6</span> <span class="token punctuation">{</span><br>        <span class="token keyword">return</span> <span class="token boolean">true</span><br>    <span class="token punctuation">}</span><br>    <span class="token keyword">return</span> <span class="token boolean">false</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><br>    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><br><span class="token punctuation">}</span></code></pre><p>有個 slice，其中包含 {1,3,5,7,9,11}，判斷條件是 element 小於 6，就將它放到新的 slice 中。執行結果是</p><pre class="language-bash"><code class="language-bash">ken@DESKTOP:~/git/medium-example-golang$ ./bin/genny <br><span class="token punctuation">[</span><span class="token number">1</span> <span class="token number">3</span> <span class="token number">5</span><span class="token punctuation">]</span></code></pre><p>這樣就能完成 slice 的篩選。</p><h2 id="using-type-assertion"><a href="#using-type-assertion" class="direct-link">#</a> Using Type Assertion</h2><p>如前面提到的，Filter 函式因為需要宣告型別，只能用於 int[]。實際情境裡，開發者可能會需要用到 string[]、float32[]，或者是自己定義的 struct[]。為每個型別個別開發 Filter，會造成大量重複代碼，修改時也要一個一個改，很花功夫。</p><p>Golang 可以用型別斷言來解決這問題。在 Golang 中，所有型別的基本型別都是 interface{}，類似 C 語言的 void。interface{} 可以容納任意型別，同時它有 var.(type)，讓開發者可以動態判斷變數型別。</p><p>修改 pkg，新增 FilterWithInterface</p><pre class="language-go"><code class="language-go"><span class="token comment">// FilterWithInterface filter slice</span><br><span class="token keyword">func</span> <span class="token function">FilterWithInterface</span><span class="token punctuation">(</span>source <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> callback <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">{</span><br>    <span class="token keyword">var</span> outInt <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><br>    <span class="token keyword">var</span> outFloat32 <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">float32</span><br>    <span class="token keyword">switch</span> source<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token keyword">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">case</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">:</span><br>        <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> element <span class="token operator">:=</span> <span class="token keyword">range</span> source<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>            <span class="token keyword">if</span> <span class="token function">callback</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>                outInt <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>outInt<span class="token punctuation">,</span> element<span class="token punctuation">)</span><br>            <span class="token punctuation">}</span><br>        <span class="token punctuation">}</span><br>        <span class="token keyword">return</span> outInt<br>    <span class="token keyword">case</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">float32</span><span class="token punctuation">:</span><br>        <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> element <span class="token operator">:=</span> <span class="token keyword">range</span> source<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">float32</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>            <span class="token keyword">if</span> <span class="token function">callback</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>                outFloat32 <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>outFloat32<span class="token punctuation">,</span> element<span class="token punctuation">)</span><br>            <span class="token punctuation">}</span><br>        <span class="token punctuation">}</span><br>        <span class="token keyword">return</span> outFloat32<br>    <span class="token punctuation">}</span><br>    <span class="token keyword">return</span> <span class="token boolean">nil</span><br><span class="token punctuation">}</span></code></pre><p>將引數型別改成 interface{}</p><pre class="language-go"><code class="language-go"><span class="token keyword">switch</span> source<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token keyword">type</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br><span class="token keyword">case</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">:</span><br><span class="token comment">//...</span><br><span class="token keyword">case</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">float32</span><span class="token punctuation">:</span><br><span class="token comment">//...</span><br><span class="token punctuation">}</span></code></pre><p>用 source.(type) 取得 source 的型別，並用 switch case 來進行對應處理</p><pre class="language-go"><code class="language-go"><span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> element <span class="token operator">:=</span> <span class="token keyword">range</span> source<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">if</span> <span class="token function">callback</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        outInt <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>outInt<span class="token punctuation">,</span> element<span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><span class="token keyword">return</span> outInt</code></pre><p>對於 []int 的例子，在使用時用型別斷言，指定該型別是 []int。可以把型別斷言想像成是強制轉型，斷言後語言會用 []int 來處理該變數。要特別注意的是，由於是動態判斷，它會跳過編譯器靜態檢查，如果出現型別錯誤，不會在編譯期報警，而是要到執行期才會告知。儘管 interface{} 有更高的自由度，但也會增加除錯的代價。</p><p>通常用型別斷言會搭配 switch 或斷言檢查，避免程式直接 panic，switch 前面看過了，而斷言檢查的語法是</p><pre class="language-go"><code class="language-go"><span class="token keyword">if</span> v<span class="token punctuation">,</span> ok <span class="token operator">:=</span> v<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">!</span>ok<span class="token punctuation">{</span><br>    fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"hey guys! you enter a wrong type!"</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span></code></pre><p>ok 如果是 true，表示型別轉換正確；反之有錯誤。</p><p>因為 pkg 修改了，cmd 也要有對應修改，改成</p><pre class="language-go"><code class="language-go">num <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">}</span><br>num2 <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">float32</span><span class="token punctuation">{</span><span class="token number">1.0</span><span class="token punctuation">,</span> <span class="token number">3.0</span><span class="token punctuation">,</span> <span class="token number">5.0</span><span class="token punctuation">,</span> <span class="token number">7.0</span><span class="token punctuation">,</span> <span class="token number">9.0</span><span class="token punctuation">,</span> <span class="token number">11.0</span><span class="token punctuation">}</span><br><span class="token keyword">var</span> out <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><br><br><span class="token comment">// filter by int filter</span><br>out <span class="token operator">=</span> genny<span class="token punctuation">.</span><span class="token function">FilterWithInterface</span><span class="token punctuation">(</span>num<span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>element <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{</span><br>    <span class="token keyword">if</span> element<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">6</span> <span class="token punctuation">{</span><br>        <span class="token keyword">return</span> <span class="token boolean">true</span><br>    <span class="token punctuation">}</span><br>    <span class="token keyword">return</span> <span class="token boolean">false</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><br>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>out<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br><br><span class="token comment">// filter by float filter</span><br>out <span class="token operator">=</span> genny<span class="token punctuation">.</span><span class="token function">FilterWithInterface</span><span class="token punctuation">(</span>num2<span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>element <span class="token keyword">interface</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{</span><br><span class="token keyword">if</span> element<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token builtin">float32</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">6</span> <span class="token punctuation">{</span><br>        <span class="token keyword">return</span> <span class="token boolean">true</span><br>    <span class="token punctuation">}</span><br>    <span class="token keyword">return</span> <span class="token boolean">false</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><br>fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>out<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">float32</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><p>建立 2 個 slice，1 個是 int，1 個是 float32。可以看到 FilterWithInterface 能處理這兩個不同型別的 Case。</p><h2 id="using-genny-to-implement"><a href="#using-genny-to-implement" class="direct-link">#</a> Using genny to Implement</h2><p>型別斷言的問題是會引入執行期錯誤，同時產生多餘的開銷。在 C++ 中，會用 template 來處理類似情況，例如</p><pre class="language-cpp"><code class="language-cpp"><span class="token keyword">template</span> <span class="token operator">&lt;</span><span class="token keyword">typename</span> <span class="token class-name">T</span><span class="token operator">></span><br>T <span class="token function">Filter</span><span class="token punctuation">(</span>T arr<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token operator">=</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">auto</span> element<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span><br><span class="token punctuation">}</span></code></pre><p>像這類可以處理泛用型別的語法，稱為泛型。</p><p>因為要處理泛用型別，編譯時會需要做許多檢查，連帶會降低編譯速度，考量到這點，Golang 沒將泛型放進設計中。</p><blockquote><p>Generics may well be added at some point. We don’t feel an urgency for them.<br>…<br>Generics are convenient but they come at a cost in complexity in the type system and run-time… Meanwhile, Go’s built-in maps and slices, plus the ability to use the empty interface to construct containers mean in many cases it is possible to write code that does what generics would enable, if less smoothly.</p></blockquote><p>至少在設計層面，Golang 建議用 interface{} 頂著。</p><p>好的，官方沒有工具，但如果開發者還是想要泛型怎麼辦？genny 的設計思維是，開發者可以提供函式原型(proto-type)，再使用 Code Generator 依照原型產生函式。相對原本方案要開發者一個一個處理類型，genny 用工具自動生成，省掉手動時間。</p><p>genny 的 GitHub 在<a href="https://github.com/cheekybits/genny" rel="noopener noreferrer" target="_blank">這裡</a>。</p><p>使用前，安裝 genny 的命令行工具</p><pre class="language-bash"><code class="language-bash">go get github.com/cheekybits/genny</code></pre><p>在 pkg 下新增 genny 的原型檔 source.go</p><pre><code>project
├── cmd
│   └── genny
│       └── main.go
├── pkg
│   └── genny
│       ├── source.go
│       └── genny.go
├── scripts
├── go.mod
├── Makefile
└── README.md
</code></pre><p>內容是</p><pre class="language-go"><code class="language-go"><span class="token keyword">package</span> genny<br><br><span class="token keyword">import</span> <span class="token string">"github.com/cheekybits/genny/generic"</span><br><br><span class="token comment">// NOTE: this is how easy it is to define a generic type</span><br><span class="token keyword">type</span> Something generic<span class="token punctuation">.</span>Type<br><br><span class="token comment">//FilterWithSomething filter Something type</span><br><span class="token keyword">func</span> <span class="token function">FilterWithSomething</span><span class="token punctuation">(</span>source <span class="token punctuation">[</span><span class="token punctuation">]</span>Something<span class="token punctuation">,</span> callback <span class="token keyword">func</span><span class="token punctuation">(</span>Something<span class="token punctuation">)</span> <span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>Something <span class="token punctuation">{</span><br>    <span class="token keyword">var</span> out <span class="token punctuation">[</span><span class="token punctuation">]</span>Something<br>    <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> element <span class="token operator">:=</span> <span class="token keyword">range</span> source <span class="token punctuation">{</span><br>        <span class="token keyword">if</span> <span class="token function">callback</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>            out <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>out<span class="token punctuation">,</span> element<span class="token punctuation">)</span><br>        <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br>    <span class="token keyword">return</span> out<br><span class="token punctuation">}</span></code></pre><p>引入 genny 專案</p><pre class="language-go"><code class="language-go"><span class="token keyword">import</span> <span class="token string">"github.com/cheekybits/genny/generic"</span></code></pre><p>宣告泛用類型</p><pre class="language-go"><code class="language-go"><span class="token keyword">type</span> Something generic<span class="token punctuation">.</span>Type</code></pre><p>跟類型有關的地方，都改為 Something</p><pre class="language-go"><code class="language-go"><span class="token comment">//FilterWithSomething filter Something type</span><br><span class="token keyword">func</span> <span class="token function">FilterWithSomething</span><span class="token punctuation">(</span>source <span class="token punctuation">[</span><span class="token punctuation">]</span>Something<span class="token punctuation">,</span> callback <span class="token keyword">func</span><span class="token punctuation">(</span>Something<span class="token punctuation">)</span> <span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>Something <span class="token punctuation">{</span><br>    <span class="token keyword">var</span> out <span class="token punctuation">[</span><span class="token punctuation">]</span>Something<br>    <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> element <span class="token operator">:=</span> <span class="token keyword">range</span> source <span class="token punctuation">{</span><br>        <span class="token keyword">if</span> <span class="token function">callback</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>            out <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>out<span class="token punctuation">,</span> element<span class="token punctuation">)</span><br>        <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br>    <span class="token keyword">return</span> out<br><span class="token punctuation">}</span></code></pre><p>genny 產生程式碼時，會自動將關鍵字換掉，改為需要的類型。</p><p>使用命令行來執行</p><pre class="language-bash"><code class="language-bash">genny -in ./pkg/genny/source.go -out ./pkg/genny/gencode.go gen <span class="token string">"Something=int,string,float32"</span></code></pre><p>-in 是輸入；-out 是輸出；gen 後面接要替換的關鍵字與類型，這邊將 Something 換成 int、string、float32。</p><p>執行後產出 gencode.go，內容是</p><pre class="language-go"><code class="language-go"><span class="token comment">// This file was automatically generated by genny.</span><br><span class="token comment">// Any changes will be lost if this file is regenerated.</span><br><span class="token comment">// see [https://github.com/cheekybits/genny](https://github.com/cheekybits/genny)</span><br><br><span class="token keyword">package</span> genny<br><br><span class="token comment">//FilterWithInt filter int type</span><br><span class="token keyword">func</span> <span class="token function">FilterWithInt</span><span class="token punctuation">(</span>source <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">,</span> callback <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span> <span class="token punctuation">{</span><br>    <span class="token keyword">var</span> out <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><br>    <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> element <span class="token operator">:=</span> <span class="token keyword">range</span> source <span class="token punctuation">{</span><br>        <span class="token keyword">if</span> <span class="token function">callback</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>            out <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>out<span class="token punctuation">,</span> element<span class="token punctuation">)</span><br>        <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br>    <span class="token keyword">return</span> out<br><span class="token punctuation">}</span><br><br><span class="token comment">//FilterWithString filter string type</span><br><span class="token keyword">func</span> <span class="token function">FilterWithString</span><span class="token punctuation">(</span>source <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">,</span> callback <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span> <span class="token punctuation">{</span><br>    <span class="token keyword">var</span> out <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><br>    <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> element <span class="token operator">:=</span> <span class="token keyword">range</span> source <span class="token punctuation">{</span><br>        <span class="token keyword">if</span> <span class="token function">callback</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>            out <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>out<span class="token punctuation">,</span> element<span class="token punctuation">)</span><br>        <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br>    <span class="token keyword">return</span> out<br><span class="token punctuation">}</span><br><br><span class="token comment">//FilterWithFloat32 filter float32 type</span><br><span class="token keyword">func</span> <span class="token function">FilterWithFloat32</span><span class="token punctuation">(</span>source <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">float32</span><span class="token punctuation">,</span> callback <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token builtin">float32</span><span class="token punctuation">)</span> <span class="token builtin">bool</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">float32</span> <span class="token punctuation">{</span><br>    <span class="token keyword">var</span> out <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">float32</span><br>    <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> element <span class="token operator">:=</span> <span class="token keyword">range</span> source <span class="token punctuation">{</span><br>        <span class="token keyword">if</span> <span class="token function">callback</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>            out <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>out<span class="token punctuation">,</span> element<span class="token punctuation">)</span><br>        <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br>    <span class="token keyword">return</span> out<br><span class="token punctuation">}</span></code></pre><p>函式自動生成！得到 3 個新函式，FilterWithInt、FilterWithString、FilterWithFloat32。</p><p>回去修改 cmd，改為</p><pre class="language-go"><code class="language-go">out <span class="token operator">=</span> genny<span class="token punctuation">.</span><span class="token function">FilterWithInt</span><span class="token punctuation">(</span>num<span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>element <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{</span><br>    <span class="token keyword">if</span> element <span class="token operator">&lt;</span> <span class="token number">6</span> <span class="token punctuation">{</span><br>        <span class="token keyword">return</span> <span class="token boolean">true</span><br>    <span class="token punctuation">}</span><br>    <span class="token keyword">return</span> <span class="token boolean">false</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>跟 Step 1 用法相同，只是名稱變成 FilterWithInt。</p><h2 id="add-go-generate"><a href="#add-go-generate" class="direct-link">#</a> Add go generate</h2><p>用 Code Gen 的問題是需要執行命令行，在協作專案中，開發者可能不知道同伴用哪些指令來產生程式碼，這些資訊應該要能納入版本管理，讓 Code Gen 有跡可循。這時可以用 go generate。</p><p>go generate 是 Golang 內建的工具，它可以用來調用命令行指令，可以看成是 Golang 底下的 shell，用於協調 Golang 跟其他程式的互動。當執行 go generate 時，Golang 會去看專案底下的 .go 檔有沒有 go generate 的註解，如果有就依照註解來執行。</p><p>具體來說，修改 pkg 的 source.go，加入</p><pre class="language-go"><code class="language-go"><span class="token keyword">package</span> genny<br><br><span class="token comment">// ...</span><br><br><span class="token comment">//go:generate genny -in ./source.go -out ./gencode.go gen "Something=int,string,float32"</span><br><br><span class="token comment">// ...</span><br><span class="token keyword">type</span> Something generic<span class="token punctuation">.</span>Type</code></pre><p>在 shell 輸入</p><pre class="language-bash"><code class="language-bash">go generate ./<span class="token punctuation">..</span>.</code></pre><p>Golang 讀到 go:generate 開頭的註解，就會執行後面的命令，如果像我一樣，習慣用 Make 來編譯的話，可以將 Makefile 改成</p><pre class="language-makefile"><code class="language-makefile"><span class="token symbol">all</span><span class="token punctuation">:</span> <span class="token variable">$</span><span class="token punctuation">{</span>OUT_DIR<span class="token punctuation">}</span> <span class="token variable">$</span><span class="token punctuation">{</span>FILES_OUT<span class="token operator">:=</span>.exe<span class="token punctuation">}</span><br><br><span class="token symbol"><span class="token variable">$</span>{OUT_DIR}/%</span><span class="token punctuation">:</span><br>    go generate ./... <br><span class="token symbol">    go build -o <span class="token variable">$</span>(@) ./cmd/<span class="token variable">$</span>(basename <span class="token variable">$</span>{[@F](http</span><span class="token punctuation">:</span>//twitter.com/F<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><p>在 go build 前執行 go generate，就能串起編譯流程。</p><h2 id="%E5%B0%8F%E7%B5%90"><a href="#%E5%B0%8F%E7%B5%90" class="direct-link">#</a> 小結</h2><p>比較幾個方案，我自己是傾向用型別斷言。開發者調用函式時，不用思考需要用 FilterWithString 還是 FilterWithFloat32，看起來更直覺，也更接近 C++ 的泛型。相對的，缺點是不知道傳入的型別，容易引發執行期錯誤；genny 則是嘗試用 Golang 的基本語法，解決掉泛型的問題。</p><p>嚴格說來，兩種解法都不能取代真正的泛型。在注重生產力的現代語言環境中，沒有泛型真的是件頗奇怪的事。我猜 Golang 看重編譯速度，應該還是跟 Monorepo 的管理方式有關？</p><h2 id="reference"><a href="#reference" class="direct-link">#</a> Reference</h2><ul><li><a href="https://blog.golang.org/generics-next-step" rel="noopener noreferrer" target="_blank">The Next Step for Generics</a></li><li><a href="https://golang.org/doc/faq#generics" rel="noopener noreferrer" target="_blank">Frequently Asked Questions (FAQ)</a></li><li><a href="https://github.com/cheekybits/genny" rel="noopener noreferrer" target="_blank">https://github.com/cheekybits/genny</a></li></ul><div class="article-footer"></div><div><p style="font-weight: bold;">標籤</p><div class="post-tags"><a href="/tags/go/" class="post-tag">Go</a></div><p style="font-weight: bold;">其他文章</p><ul><li><a href="/posts/2022/three-semantics-of-rabbitmq/">關於消息的三層語義：以 RabbitMQ 為例</a></li><li><a href="/posts/2020/database-migration-by-go/">資料庫版本遷移：以 Go 為例</a></li><li><a href="/posts/2020/mqtt-a-light-weight-mq/">MQTT：輕量的消息隊列協定</a></li><li><a href="/posts/2020/use-protobuf-in-golang/">一種更緊湊的數據格式：Protobuf 入門</a></li><li><a href="/posts/2019/use-prometheus-to-monitor-end-devices/">監控節點的度量指標：Prometheus 入門</a></li></ul></div><p style="font-weight: bold;">評論</p><script async="" src="https://utteranc.es/client.js" crossorigin="anonymous" id="utterance-script" issue-term="title" label="utterance" repo="ken00535/blog" theme="github-light"></script><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "Article",
  "headline": "Go 的泛型替代方案：型別斷言與代碼生成",
  "image": [],
  "author": {
    "@type": "Person",
    "name": ""
  }, 
  "publisher": {
    "@type": "Organization",
    "name": "Ken Chen&#39;s Blog",
    "url": "https://blog.kenwsc.com",
    "logo": {
      "@type": "ImageObject",
      "url": "https://blog.kenwsc.com/img/favicon/favicon.png",
      "width": 512,
      "height": 512
    }
  },
  "url": "https://blog.kenwsc.com/posts/2020/go-generic-alter-plan-assert-and-codegen/",
  "mainEntityOfPage": "https://blog.kenwsc.com/posts/2020/go-generic-alter-plan-assert-and-codegen/",
  "datePublished": "2020-09-19",
  "dateModified": "2022-12-10",
  "description": "用函數式編程(Functional Programming)的風格寫程式時，會常常重複使用一些通用函式，舉個例子，假設有個 array，開發者需要從該 array 中篩選符合條件的元素，重新組成新的 array。合理的情況是，如果有個 filter..."
}</script></article></main><footer><div class="footer-logos"><a href="https://medium.com/@ken00535" rel="noopener noreferrer" target="_blank"><img alt="medium" height="50" src="/img/icons/icon_social media_medium.svg" width="50"></a><a href="https://www.linkedin.com/in/ken00535" rel="noopener noreferrer" target="_blank"><img alt="linkedin" height="30" src="/img/icons/icon_social media_linkedln.svg" width="30"></a><a href="https://blog.kenwsc.com/feed/feed.xml" rel="noreferrer noopener" target="_blank"><img alt="rss feed" height="30" src="/img/icons/rss-feed.svg" width="30"></a></div><div class="copyright">© 2022 Ken Chen's Blog, Powered by <a href="https://github.com/google/eleventy-high-performance-blog" rel="noopener noreferrer" target="_blank">eleventy-high-performance-blog</a></div></footer><script>// light/dark theme switch
      // disable dark mode for now
      const menuBtn = document.querySelector('.menu__btn')
      menuBtn.addEventListener('click', function() {
        document.querySelector('body').classList.toggle('lock')
        menuBtn.classList.toggle('menu__btn--close');
        document.querySelector('.nav__links').classList.toggle('nav__links--open')
      })</script></body></html>